{% extends "vware/baseArmazem.html" %}
{% load static %}
{% load utils %}

{% block body_title %}
<style>

    .button {
     
        height: 70px;
       
        font-family: Arial, "Helvetica", sans-serif;
        font-size: 45px;
        color: #fff;
        text-decoration: none;
        text-align: center;
        text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
        padding-top: 6px;
        margin-left: auto;
        margin-right: auto;
        left: 30px;
        position: relative;
        cursor: pointer;
        border: none;
        background: #FBA51A;
        background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
        border-radius: 5px;
        box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;
   
    }
    
    .tr-hover
    {  
        background-color:#fefefe;
    }

    
    .buttons{
        padding: 15px 25px;
        background: #FBA51A;
        text-align: center;
        padding-top: 6px;
        font-size: 15px;
        width: 100px; 
        margin-left: 8px"
    }

    .buttonAddClient{
        height: 45px;
       
       font-family: Arial, "Helvetica", sans-serif;
       font-size: 15px;
       color: #fff;
       text-decoration: none;
       text-align: center;
       text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
       padding-top: 6px;
       margin-left: auto;
       margin-right: auto;
       left: 30px;
       position: relative;
       cursor: pointer;
       border: none;
       background: #FBA51A;
       background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
       border-radius: 5px;
       box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;
  
    }
    

    .buttonsUpdate1{
        position: relative;
        right:    0;
        bottom:   35px;
        padding: 5px 10px;
        background: #FBA51A;
        text-align: center;
        font-size: 15px;
        margin: 0;
        width: 5%;
        height: auto;
        margin-left: 81%;
        
    }
    .buttonsUpdate2{
        position: relative;
        right:    0;
        bottom:   70px;
        padding: 5px 10px;
        background: #FBA51A;
        text-align: center;
        font-size: 15px;
        margin: 0;
        width: 5%;
        height: auto;
        margin-left: 81%;
    }
    .buttonsPaginator{
        position: relative;
        padding: 5px 10px;
        background: #FBA51A;
        text-align: center;
        
    }
    .buttonFirst{
        position: relative;
        right:    0;
        background: #FBA51A;
        text-align: center;
        margin: 0;
        height: auto;

        padding: 2px 5px;
        font-size: 15px;
        width: 4%;
        margin-left: 80%;
        bottom:   121px;


    }
    .buttonPrevious{
        position: relative;
        right:    0;
        background: #FBA51A;
        text-align: center;
        margin: 0;
        height: auto;

        padding: 2px 5px;
        font-size: 15px;
        width: 4%;
        margin-left: 84%;
        bottom:   145px;
    }
    .buttonActual{
        position: relative;
        right:    0;
        background: #FBA51A;
        text-align: center;
        margin: 0;
        height: auto;

        padding: 2px 5px;
        font-size: 15px;
        width: 2%;
        margin-left: 88%;
        bottom:   169px;
    }
    .buttonNext{
        position: relative;
        right:    0;
        background: #FBA51A;
        text-align: center;
        margin: 0;
        height: auto;

        padding: 2px 5px;
        font-size: 15px;
        width: 3%;
        margin-left: 90%;
        bottom:   193px;
    }
    .buttonLast{
        position: relative;
        right:    0;
        background: #FBA51A;
        text-align: center;
        margin: 0;
        height: auto;

        padding: 2px 5px;
        font-size: 15px;
        width: 3%;
        margin-left: 93%;
        bottom:   217px;
    }
  
 </style>
    <div class="text-primary" xmlns="http://www.w3.org/1999/html">
        <h6><b><i class="fa fa-home text-secondary"></i><a href={% url 'main:main' %}><span
                class="text-secondary"> Home | </span></a> Supply Package</b></h6>
    </div>
{% endblock %}


{% block body_content %}
  <div class="containerPath mt-4" style="margin-left: 30px">
        <div class="path" id="uploadClass"
            <div class="mt-3">
                {% if erro %}
                    <br/>
                    <div class="text-center">
                        <h1><b>{{ erro }}</b></h1>
                    </div>
                    <br/>
                {% endif %}
                <table id="example" class="stripe hover cell-border " style="width:100%">
                    <thead>
                    <tr>
                        <td >Cliente</td>
                        <td>Product Description</td>
                        <td>Product Name</td>
                        <td>Comment</td>
                        <td>Quantity</td>
                        <td></td>
                        <td></td>
                    </tr>
                    </thead>
                    <tbody>
                            <!-- quero que por cada cliente/supplyPackage mostre cliente e cenas do suppluPackage -->
                        {% for cliente in clientes.all%}
                             {% for supplyPackage in supply.all%}
                            <!-- tens de fazer um if para mostrares apenas os clientes que têm ids partilhados -->
                                 {%if cliente.suplyPackage_id == supplyPackage.id%}

                                     <tr>
                                <!--      <td>{{ produtos.cliente.oem }}</td>_id
                                    <td>{{ prod.descricao }}</td>
                                    <td>{{ prod.comentario }}</td>  -->
                                        <td style="width: 25%" title="{{ cliente.oem|default:'Empty' }}">{{ cliente.oem|default:"" }}</td>
                                        <td style="width: 25%" title="{{ supplyPackage.description|default:'Empty' }}">{{ cliente.suplyPackage.id|default:""}}</td>
                                        <td style="width: 25%" title="{{ supplyPackage.description|default:'Empty' }}">{{ supplyPackage.description|default:""}}</td>
                                        <td style="width: 25%" title="{{ supplyPackage.comment|default:'Empty' }}">{{ supplyPackage.comment|default:"" }}</td>
                                        <td style="width: 25%" title="{{ supplyPackage.stock|default:'Empty' }}">{{  supplyPackage.stock|default:"" }}</td>
                                    
                                        
                                                                    
                                        <td style="width: 7%">
                                            <div class="form-inline">
                                                <a type="button" id="botaoEdit" title="Edit" class="fas fa-pen-square"
                                                style="height: 18px; margin-left: 10px"
                                                data-toggle="modal" data-target="#updateLinha">
                                                </a>
                                                <a type="button" id="botaoDelete" title="Delete" class="fas fa-trash-alt"
                                                style="margin-left: 10px; height: 18px"
                                                data-toggle="modal" data-target="#deleteLinha">
                                                </a>
                                            </div>
                                        </td>
                                            <td style="display: none" value="{{  cliente.suplyPackage.id }}">{{  cliente.suplyPackage.id }}</td>
                                    </tr>
                                {%endif%}
                        
                            {% endfor %} 
                    {% endfor %}
                        </tbody>
                    <tfoot>
                    <tr>
                        <th>Cliente</th>
                        <th>Descrição</th>
                        <th></th>
                        <th>Comentario</th>
                        <th></th>
                        <th></th>
                        
                     
                    </tr>
                    </tfoot>
                </table>
                
                    <div style="width: 30%; margin-left: 30%; bottom: 10%; position: absolute; border: 3px solid transparent; text-align: center">
                        <button type="submit" class="button"  data-toggle="modal"
                                data-target="#addLinha">
                            NOVO ITEM
                        </button>
                    </div>


                          <div class="form-inline" style="width: 570px">
                          <h4 class="mt-3">IMPORT XLSX FILE:</h4>
                          <input style="margin-left: 20px; margin-top: 1px" type="file" name="myfile" id="myfile"
                                 title="Choose File"></br>
      </div>
     
      <button title="Upload Excel" class="btn btn-outline-primary" style="margin-left: 154px" onclick="uploadStockPackage()" type="submit">
          Upload
      </button>

    <!-- Modal onde é adicionada uma nova linha -->
        {% csrf_token %}
        <div class="modal fade" id="addLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="myModalLabel"><b>Create new row</b></h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-inline">
                            <p class="mt-2">Package Part number: </p>
                            <input style="margin-left: 80px" type="text" id="pnAdd" name="pnAdd" value="{{ kitSuplyPackage.part_number}}">
                        </div>
                  
                        <div class="form-inline">
                            <p class="mt-2">Package desctription: </p>
                            <input style="margin-left: 68px" type="text" id="supplyDescriptionAdd" name="prodDescriptionAdd"
                                   value="{{ kitSuplyPackage.description }}">
                        </div>
                        <div class="form-inline">
                            <p class="mt-2">Comment: </p>
                            <input style="margin-left: 67px" type="text" id="supplyCommentAdd" name="prodCommentAdd"
                                   value="{{ kitSuplyPackage.comment }}">
                        </div>
                        <div class="form-inline">
                            <p class="mt-2">Supply Time </p>
                            <select style="margin-left: 42px; width: 160px" name="supplyTimeAdd" id="supplyTimeAdd">
                                <option value=""></option>
                                <option value="30">30</option>
                                <option value="60">60</option>
                                <option value="90">90</option>
                                <option value="120">120</option>
                                <option value="150">150</option>
                                <option value="180">180</option>
                                <option value="210">210</option>
                                <option value="240">240</option>
                            </select>
                        </div>
                       
                        <div class="form-inline">
                            <p class="mt-2">Stock: </p>
                            <input style="margin-left: 45px" type="number" id="supplyStockAdd" name="prodStockAdd"
                                   value="{{ kitSuplyPackage.inventario}}">
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Link: </h6>
                                   <input type="file"  style="margin-left: 67px" name="novoLinkEdit"  id="novoLinkEdit" value="{{ stock_package.link }}"/>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Clients: </h6>
                            <button type="button" id="openClientPackage" name="openClientPackage" style="margin-left: 33px"> 
                                Open
                            </button>
                        </div>
                       
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Stock Packages: </h6>
                            <button type="button" id="openBomb" name="openBomb" style="margin-left: 30px">
                                Open
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" id="CreateSubmiteButton">Create</button>
                    </div>
                </div>
            </div>
        </div>


    <!-- Modal onde é feito o delete de uma linha especifica -->
    <form method="POST" class="form" action="{% url 'pManagement:deleteLinhaClienteProduto' %}"
          enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal fade" id="deleteLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="myModalLabel"><b>Delete this row?</b></h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <p id="infoDelete"></p></br>
                        <input type="hidden" id="rowIdDelete" name="rowIdDelete" value="{{rowIdDelete}}">
                       
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Modal onde é feito EDIT de cada linha -->
    <form method="POST" class="form" action="{% url 'pManagement:updateSupplyPackage' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal fade" id="updateLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="myModalLabel"><b>Edit Row</b></h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>

                    </div>
                    <div class="modal-body">
                  
                        

                        <h3><b>Replace by: </b></h3>
                  <!--       <div class="form-inline">
                            <h6 class="mt-1">Client: </h6>
                            <select style="margin-left: 75px" name="novoCliente" id="novoCliente">
                                <option value="">Select Client</option>
                                {% for client in clientes.all %}
                                    <option value="{{ client.id }}">{{ client.oem }}</option>
                                {% endfor %}
                            </select>
                            <input placeholder="Type here new client" type="form" name="novoClienteInput"
                                   id="novoClienteInput" style="margin-left: 16px">
                        </div> -->
                        
                        <!-- NÂO ESTÀ A PASSAR O ID -->
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Part Number: </h6>
                            <input placeholder="New description" type="form" name="novoPartNumberEdit"
                                   id="novoPartNumberEdit" style="margin-left: 21px; width: 300px"  value="{{ kitSuplyPackage.part_number}}">
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Description: </h6>
                            <input placeholder="New description" type="form" name="novoDescriptionEdit"
                                   id="novoDescriptionEdit" style="margin-left: 21px; width: 300px"  value="{{ kitSuplyPackage.description }}">
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Comment: </h6>
                            <input placeholder="New Comment" type="form" name="novoCommentEdit"
                                   id="novoCommentEdit" style="margin-left: 21px; width: 300px"  value="{{ kitSuplyPackage.comment }}">
                        </div>
                     
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Quantity: </h6>
                            <th style="width: 5%" id="novoStockProdutoEdit" name="novoStockProdutoEdit" title="{{ kitSuplyPackage.inventario|default:'Empty' }}">
                                <input style="width: 70px; margin-left: 8px" class="" 
                                type="number"
                                name="novoInventarioSupplyPackEdit" id="novoInventarioSupplyPackEdit"
                                value="{{ kitSuplyPackage.inventario|default:"" }}">
                            </th>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Supply Time: </h6>
                            <select style="margin-left: 38px" name="novoSupplyTimeEdit" id="novoSupplyTimeEdit">
                                <option value=""></option>
                                <option value="30">30</option>
                                <option value="60">60</option>
                                <option value="90">90</option>
                                <option value="120">120</option>
                                <option value="150">150</option>
                                <option value="180">180</option>
                                <option value="210">210</option>
                                <option value="240">240</option>
                            </select>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Link: </h6>
                                   <td><input type="file"  style="margin-left: 67px" name="novolinkEdit"  id="novolinkEdit" value="{{ kitSuplyPackage.link }}"/></td>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Clients: </h6>
                            <button type="button" id="openClientPackage" name="openClientPackage" style="margin-left: 33px">
                                Open
                            </button>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Stock Package: </h6>
                            <button type="button" id="openBomb" name="openBomb" style="margin-left: 30px">
                                Open
                            </button>
                        </div>
                        <input type="hidden" id="rowIdUpdate" name="rowIdUpdate" value="{{ rowIdUpdate }}">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </form>





    <!-- tabelas dos clicaveis -->
    <!-- Clicavél da tablea -->
    <div class="modal fade" id="partNumbersExpendable" data-backdrop="false" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title" id="myModalLabel"><b>Cliente Package:</b></h3>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                       aria-hidden="true">&times;</span></button>
           </div>
           <div class="modal-body">
               <p id="infoLinhaExpendable"></p></br>
               <table id="pnExpendableTable" class="display" style="width: 100%">
                   <thead>
                   <tr>
                       <td></td>
                       <th>Client name</th>
                       <th></th>
                       <th style="display: none"></th>
                   </tr>
                   </thead>
                   <tbody>
                   {% for pn in cliente.all %}
                       <tr>
                           <td></td>
                           <td>{{ pn.oem }}</td>
                           <td></td>
                           <td>{{ pn.id }}</td>
                       </tr>
                   {% endfor %}
                   </tbody>
                   <tfoot>
                   <tr>
                       <td></td>
                       <th></th>
                       <td></td>
                       <td></td>
                       
                   </tr>
                   
                   </tfoot>
               </table>

           </div>
          
        </div>
        
           <div class="modal-footer">
               <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               <!-- <button type="submit" id="savePNExpendable" class="btn btn-primary">Save</button> -->
           </div>
           <!-- ADD BTN AQUI -->
           <div style="width: 25%; margin-left: 66%; bottom: 16%; position: absolute; border: 3px solid transparent; text-align: center">
            <button type="submit" class="buttonAddClient"  data-toggle="modal"
                    data-target="#addLinha">
                NOVO CLIENTE
            </button>
        </div>
       </div>
       
    </div>
    </div>

    <div class="modal fade" id="partNumbersReturnable" data-backdrop="false" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Part numbers Stock Package</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="infoLinhaReturnable"></p></br>
                    <table id="pnReturnable" class="display" style="width:100%">
                        <thead style="width:100%">
                        <tr>
                            <th></th>
                            <th>Part numbers</th>
                            <th>Description</th>
                            <th style="display: none"></th>
                        </tr>
                        </thead>
                            <!-- Aqui nao apanha nada porque tens as vars mal dobriga -->
                        <tbody>
                        {% for pn in stock_package_parts.all %}
                            <tr>
                                <td></td>
                                <td> {{ pn.pn }} </td>
                                <td> {{ pn.descricao }} </td>
                                <td> {{ pn.id }} </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot>
                        <tr>
                            <td></td>
                            <th></th>
                            <td></td>
                            <td></td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <!-- <button type="submit" id="savePNReturnable" class="btn btn-primary">Save</button> -->
                </div>
            </div>
        </div>
    </div>


<!-- Clicavéis da tabela (btn azul)-->

    <div class="modal fade" id="showPartNumbersExpendable" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Client Package:</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="listPartNumbersExpendable"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="showPartNumbersReturnable" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Stock Package:</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="listPartNumbersReturnable"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    
<!-- MODAL DOS CLICAVEIS DO ADD/EDIT-->
  

{% endblock %}

{% block javascript %}
    <script>
        
        $('.clearable.example .ui.selection.dropdown')
            .dropdown({
                clearable: true
            })
        ;
        $('.clearable.example .ui.inline.dropdown')
            .dropdown({
                clearable: true,
                placeholder: 'any'
            })
        ;

        $(document).ready(function () {

// Setup - add a text input to each footer cell
$('#example thead th').each(function (i) {
    var title = $('#example thead th').eq($(this).index()).text();
    $(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
});



    //Tabela do primeiro btn (ClientPackage)
    $('#pnReturnable tfoot th').each(function (i) {
                console.log("print5")
                var title = $('#pnReturnable tfoot th').eq($(this).index()).text();
                $(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
                console.log("print11");
            });
            var tableReturnable = $('#pnReturnable').DataTable({
                "info": false,
                "paging": false,
                "scrollCollapse": true,
                "scrollY": "420px",
                columnDefs: [{
                    orderable: false,
                    className: 'select-checkbox',
                    targets: 0
                }],
                select: {
                    style: 'multi',
                    selector: 'td:first-child'
                },
                order: [[1, 'asc']],
                initComplete: function () {

                    this.api().columns([1]).every(function () {
                        var that = this;


                        //$('#pnReturnable tfoot tr').appendTo('#pnReturnable thead');   // To displays the search boxs at the top instead to the bottom of the table
                        $('input', this.footer()).on('keyup change clear', function () {
                            console.log("print6")
                            if (that.search() !== this.value) {
                                that
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                }
            });
    
      
      /* TABELA do popup BOMB */
    $('#pnExpendableTable tfoot th').each(function (i) {
        console.log("AO CARREGAR A PAGINA  print4"+ " ");
               /* BUG */
              var title = $('#pnExpendable tfoot th').eq($(this).index()).text();
              
              console.log("teste"+title)
              $(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
             
          });
          var tableExpendable = $('#pnExpendableTable').DataTable({
              "info": false,
              "paging": false,
              "scrollCollapse": true,
              "scrollY": "420px",
              columnDefs: [{
                  orderable: false,
                  className: 'select-checkbox',
                  targets: 0,
              }],
              select: {
                  style: 'multi',
                  selector: 'td:first-child'
              },
              order: [[1, 'asc']],

              initComplete: function () {
                

                  this.api().columns([1]).every(function () {
                      
                      var that = this;
                      //$('#pnExpendable tfoot tr').appendTo('#pnExpendable thead');   // To displays the search boxs at the top instead to the bottom of the table
                      $('input', this.footer()).on('keyup change clear', function () {
                          console.log("print10")
                          if (that.search() !== this.value) {
                              that
                                  .search(this.value)
                                  .draw();
                          }
                      });
                  });
              }
          });
          //Tabela necessarias 
var table = $('#configs').DataTable({
                "info": false,
                "scrollY": "594",
                "paging": false,
                "ordering": false,
                "orderCellsTop": true,
                "fixedHeader": true,

                select: {
                    style: 'os',
                    selector: 'th:first-child',
                    blurable: true
                },
                order: [[0, 'asc']],

                initComplete: function () {
                    
                    this.api().columns([0, 1, 2]).every(function () {
                        console.log("AO CARREGAR A PAGINA OS FILTROS");
                        var column = this;
                        var select = $('<select class="form-control" style="margin-left: -9px" id="selected"><option value=""></option></select>')
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );
                                //pode ser daqui o erro, não está a conseguir chegar ao spot
                                column
                                    .search(val ? '^' + val + '$' : '', true, false)
                                    .draw();
                            });

                        column.data().unique().sort().each(function (d, j) {
                            console.log("NESTE BLOCO MOSTRA INFOS DOS FILTOS EM BAIXO DA ROW 1/3"+ d)
                            select.append('<option value="' + d  + '">' + d + '</option>')
                        });
                    });
                },
            });

$(document).on('click', '#CreateSubmiteButton', function () {
    /* var prodNameAdd = $("prodNameAdd").val(); */
    //POPUPS NÂO TÂO AINDA
    var pnAdd = $("#pnAdd").val()
    var clienteProdDescriptionAdd = $("#supplyDescriptionAdd").val();
    var clienteProdCommentAdd = $("#supplyCommentAdd").val();
    var clienteProdProdNameAdd = $("#supplyCommentAdd").val();
    var clienteProdStockAdd = $("#supplyStockAdd").val();
    var novoLinkEdit = $("#novoLinkEdit").val();
    var clients = []
    var stockPackages = []

    $.each(tableReturnable.rows('.selected').nodes(), function (i, item) {
        var data = tableReturnable.row(this).data();
        console.log("tableReturnable", data);
        stockPackages.push(data[3])
    });
    console.log("stockPackages ",stockPackages)

    $.each(tableExpendable.rows('.selected').nodes(), function (i, item) {
        var data = tableExpendable.row(this).data();
        console.log("tableExpendable", data);
        clients.push(data[3])
    });
    console.log("clients ",clients)

    $.ajax({
            type: 'POST',
            url: "{% url 'pManagement:addRowSupplyPackage' %}",
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                clienteProdDescriptionAdd: supplyDescriptionAdd,
                prodCommentAdd: supplyCommentAdd,
                supplyTimeAdd: supplyTimeAdd,
                prodStockAdd: supplyStockAdd,
                novoLinkEdit: novoLinkEdit,
                clients: clients,
                stockPackages: stockPackages
            },
            success: function () {
                console.log("[API] Callback to the endpoint sucess")
            },
            complete: function () {
                window.location.replace("{% url 'pManagement:supplyPackage' %}")
            }
        }) 
});

/* Aqui trata do clicavél do (novo Item) o clientPackage */
$(document).on('click', '#openClientPackage', function () {
                console.log("tas do clicavel do OPEN ClientPackages");
                tableReturnable.rows().deselect();
                var myModal = new bootstrap.Modal(document.getElementById('partNumbersExpendable'));
                var va = document.getElementById("produto.pn");
                console.log(va);
                myModal.show();
            });
            $('#partNumbersExpendable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });


/* Clicavél da cell ClientPackage */
$(document).on('click', '#clientPackage', function () {
    console.log("returnable")
    var data = table.row($(this).parents('tr')).data();

    var idPacote = data[10]
    $.ajax({
        type: 'GET',
        url: '/packing/getPNExpendable',
        data: {
            idPacote: idPacote,
        },
        success: function (response) {
            console.log(response)
            var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersExpendable'))
            myModal.show()
            console.log("chegou aqui")
            if (response["listaExpendable"] != null) {
                console.log("entrou no if")
                var myArray = response["listaExpendable"]
                var myFinalString = ""
                for (var key in myArray) {
                    for (var k in myArray[key]) {
                        myFinalString += "<strong>" + k + "</strong>" + ": " + myArray[key][k]
                        myFinalString += "</br>"
                    }
                    myFinalString += "\n<br></br>"
                }
                $('#listPartNumbersExpendable').html(myFinalString);
            } else {
                $('#listPartNumbersExpendable').html(null);
            }
        }
    })
    });


    /* Aqui trata do clicavél do (novo Item) o StockPackage */
$(document).on('click', '#openBomb', function () {
                tableExpendable.rows().deselect();
                var myModal = new bootstrap.Modal(document.getElementById('partNumbersReturnable'))
                var va = document.getElementById("clientPackage.pn");
                console.log("VALUE --> ",va);
                myModal.show()
            });

            $('#partNumbersReturnable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });


    /* Clicavél da cell Bomb */
$(document).on('click', '#bomb', function () {
            console.log("bomb")
            var data = table.row($(this).parents('tr')).data();
            
            //arranjar maneira de passar o id sem ter de o ir buscar a tabela
            var idPacote = data[10]
            console.log("DATA--> ",data)
            $.ajax({
                type: 'GET',
                url: '/packing/getPNReturnable',
                data: {
                    idPacote: idPacote,
                },


                success: function (response) {
                    console.log(response)
                    var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersReturnable'))
                    myModal.show()
                    if (response["listaReturnable"] != null) {
                        console.log("entrou no if")
                        var myArray = response["listaReturnable"]
                        var myFinalString = ""
                        console.log("ARRAY-> ", myArray)
                        for (var key in myArray) {
                              for (var k in myArray[key]) {
                                myFinalString += "<strong>" + k + "</strong>" + ": " + myArray[key][k]
                                myFinalString += "</br>"
                             }
                            myFinalString += "\n<br></br>"
                            console.log("STRING -->", myFinalString)
                        }
                        
                        $('#listPartNumbersReturnable').html(myFinalString);
                    } else {
                        $('#listPartNumbersReturnable').html(null);
                    }
                }
            })
    });


$('#example').on('change', 'input', function () {
    //Get the cell of the input
    var cella = $(this).closest('th');
    
    //update the input value
    $(this).attr('value', $(this).val());
    var nome = $(this).attr('name')
    var qty = $(this).attr('value')

    //invalidate the DT cache
    table.cell($(cella)).invalidate().draw();

});
            var table = $('#example').DataTable({
                "paging": false,
                orderCellsTop: true,
                fixedHeader: true,
                "scrollY": 600,
                "info": false,

                
                select: {
                    style: 'os',
                    selector: 'th:first-child',
                    blurable: true
                },
                
                order: [[0, 'asc']],
            
                
                
                initComplete: function () {
                    this.api().columns([0, 1]).every(function () {
                        $(document).ready(function() {
  $("td").hover(
    function() {
        console.log(this.cell.getElementById.val)
       // $(this).get((this.selectedRow));
      $(this).css('color', '#000000');
    }, 
    function() {
      $(this).css('background-color', 'none');
      $(this).css('color', 'black'); // or whatever your original color was
    }
  );
});
                        var column = this;
                        
                        var select = $('<select class="form-control" style="margin-left: -18px" id="selected"><option value=""></option></select>')
  
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );
                                column
                                    .search(val ? '^' + val + '$' : '', true, false)
                                    .draw();
                            });

                        column.data().unique().sort().each(function (d, j) {
                            
                            select.append('<option value="' + d + '">' + d + '</option>')
                             console.log("tas",column.data().unique().sort());
                             console.log("Coluna ->", column);

                        });
                    });
                },
            });
           
            // Filter event handler
            $(table.table().container()).on('keyup', 'thead input', function () {
                table
                    .column($(this).data('index'))
                    .search(this.value)
                    .draw();
            });

            
            $('#example tbody').on('click', 'button', function () {

                var data = table.row($(this).parents('tr')).data();
                //alert(data[0] + "'s quantity of " + data[2] + " is: " + data[4]);
                //$("#myModal").modal('show');
                // Add response in Modal body
                //console.log("DATA-> ",data);
                var partNumber = data[0]
                var descricao = data[1]
                var comentario = data[2]
                var client_package = data[3]
                var bomb_item = data[4]
                var suply_time = data[5]
                var stock = data[6]
                var inventario = $(data[7]).val()
                var link = data[8]
                var link_value  = link;
                if (link == "") {
                    link_value = "<strong>None</strong>"
                }
                
            /*     var quantidade = data[4]
                var inventario = $(data[5]).val()
                var tipo = data[6]
                */
                //CHEKS1
                var time = moment().format('DD-MM-YYYY HH:mm:ss');
                $('#partNumber').val(partNumber);
                $('#descricao').html(descricao);
                $('#link').val(link);
                $('#comentario').val(comentario);
                $('#quantidade').val(quantidade);
                $('#inventario').val(inventario);
                $('#quantidadeEdit').val(quantidade);
                $('#inventarioEdit').val(inventario);
                $('#tipo').val(tipo);
            });

            $('#example tbody').on('click', '#botaoDelete', function () {
                var data = table.row($(this).parents('tr')).data();
                console.log("DEL--> ", data)
               /*  var partNumber = data[0]
                var descricao = data[1]
                var comentario = data[2]
                var client_package = data[3]
                var stock_package = data[4]
                var suply_time = data[5]
                var stock = data[6]
                var inventario = $(data[7]).val()
                var link = data[2] */
                var cliente = data[0]
                var descricao = data[1]
                var prodName = data[2]
                var comentario = data[3]
                var quantidade = data[4]
                //console.log(data)

                var modalInfo = "<p>" + "<b>Cliente:</b>&emsp;&emsp;" + data[0] + "</b>" +
                "<p>" + "<b>Descrição:</b>&emsp;&emsp;&emsp;" + descricao + "</p>" +
                "<p>" + "<b>Comment:</b>&emsp;&emsp;&emsp;" + comentario + "</p>" +
                "<p>" + "<b>Quantidade:</b>&emsp;&emsp;" + quantidade + "</p>" +
                "<p>" + "<b>Inventario:</b>&emsp;&emsp;" + inventario + "</p>" +

                $("#rowIdDelete").val(data[7])
                $('#infoDelete').html(modalInfo);
            });

            $('#example tbody').on('click', '#botaoEdit', function () {
                console.log("TAS NO EDIT")
                var data = table.row($(this).parents('tr')).data();
                console.log("DATA", data)
                var partNumber = data[0]
                var descricao = data[1]
                var comentario = data[2]
                
                var suply_time = data[5]
                var stock = data[6]
                var inventario = $(data[7]).val()
                var link = data[8]



                var client_package = null // data[3]
                var stock_package = null // data[4]

                document.getElementById("novoPartNumberEdit").value = partNumber
                document.getElementById("novoDescriptionEdit").value = descricao
                document.getElementById("novoCommentEdit").value = comentario
                //document.getElementById("novoClientPackageEdit").value = client_package
                //document.getElementById("novoStockPackageEdit").value = stock_package
                document.getElementById("novoSuplyTimeEdit").value = suply_time
                document.getElementById("novoStockEdit").value = stock
                document.getElementById("novoLinkEdit").value = link
                document.getElementById("quantidadeInventarioNovoEdit").value = inventario

                // preset code
                //document.getElementsByName("RetPackage")[0].checked = false
                //document.getElementsByName("ExpPackage")[0].checked = false
                //if (tipo == "ReturnablePackage")
                //    document.getElementsByName("RetPackage")[0].checked = true
                //else
                //    document.getElementsByName("ExpPackage")[0].checked = true

                $('#rowIdUpdate').val($(data[5]).attr("id"));

            });

        });

      /*   function firstClick() {
            window.location.replace("{% url 'pManagement:stockPackage' %}?page=1")
        }

        function prevClick() {
            var page = parseInt("{{ current_page }}")
            
            if ( page == 1)
                alert("Min page reached (" + 1 + ")")
            else
                window.location.replace("{% url 'pManagement:stockPackage' %}?page=" + (page-1))
        }

            
      

        function nextClick() {
            var page = parseInt("{{ current_page }}")
            var page_max = parseInt("{{ page_max }}")
            if (page == page_max)
                alert("Max page reached (" + page_max + ")")
            else
                window.location.replace("{% url 'pManagement:stockPackage' %}?page=" + (page+1))
        }

        function lastClick() {
            var page_max = parseInt("{{ page_max }}")
            window.location.replace("{% url 'pManagement:stockPackage' %}?page=" + (page_max))
        }
        */

        function botaoUpdateStock() {
            console.log("tas no btn GRAVAR")
            var inventorys = []
            var ids = []

            var table = document.getElementById('example');
                
            for (var i = 1, n = table.rows.length - 1; i < n; i++){
                var row = $(table.rows[i].cells[7].innerHTML)
                inventorys.push(row.val())
                ids.push(row.attr("id"))  
            }

            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:updateAllStockSupplyPackage' %}",
                data: {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    ids: ids,
                    inventorys: inventorys,
                },
                success: function () {
                    console.log("[API] Callback to the endpoint sucess")
                },
                complete: function () {
                    //window.location.replace("{% url 'pManagement:supplyPackage' %}")
                   // window.location.reload()
                }
            })
        }


        function botaoUpdateInventario() {
            console.log("TAS NO BTN UPDATE")
            var inventorys = []
            var ids = []
            var quantidades = []

            var table = document.getElementById('example');
            
        
            for (var i = 1, n = table.rows.length - 1; i < n; i++){
                console.log("I--> ", i)
                quantidades.push(table.rows[i].cells[8].innerHTML)
                var row = $(table.rows[i].cells[7].innerHTML)
                inventorys.push(row.val())
                ids.push(row.attr("id"))  
            }

            console.log("Making the request at updateInventory")
           
           
            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:updateInventorySupplyPackage' %}",
                data: {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    ids: ids,
                    inventorys: inventorys,
                    quantidades: quantidades,
                },
                success: function () {

                    console.log("[API] Callback to the endpoint sucess")
                },
                complete: function () {
                    window.location.reload()
                }
            }) 
    
        }


        function ClearFilters() {
            $('.form-control').val('');  // Clear ext and select inputs with classname form-control
            $('#chk').prop('checked', false).change();  // Clear checkbox and trigger change event

            var table = $('#example').DataTable();
            table
                .search('')
                .columns().search('')
                .draw();
        }

        function uploadStockPackage() {
            console.log("Button upload")
            var data = new FormData()
            var file = $("#myfile")[0].files[0]
            data.append("myfile", file)
            data.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val())

            console.log("Seding API REQ")
            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:uploadStockFile' %}",
                processData : false,
                contentType : false,
                data: data,
                success: function () {
                    console.log("[API] Callback to the endpoint sucess")
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText);
                },
                complete: function () {
                    window.location.reload()
                }
            })
        }

        $(document).on('click', '#excel', function () {
            window.location.replace("{% url 'pManagement:downloadExcelStockPackage' %}")
        });


        (document).on('click', '#openExpendable', function () {
                
                tableExpendable.rows().deselect();
                var myModal = new bootstrap.Modal(document.getElementById('partNumbersExpendable'))
                console.log("clicou"+ myModal)
                myModal.show()
            });

            $('#partNumbersExpendable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });

            $(document).on('click', '#openReturnable', function () {
                console.log("LOOOLO");
                tableReturnable.rows().deselect();
                var myModal = new bootstrap.Modal(document.getElementById('partNumbersReturnable'))
                console.log("clicou"+myModal)
                myModal.show()
            });

            $('#partNumbersReturnable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });

            $('#configs tbody').on('click', '#expendable', function () {
                var data = table.row($(this).parents('tr')).data();
                console.log("DATA"+" "+data)

                var idPacote = data[9]

                $.ajax({
                    type: 'GET',
                    url: '/packing/getPNExpendable',
                    data: {
                        idPacote: idPacote,
                    },
                    success: function (response) {
                        var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersExpendable'))
                        myModal.show()
                        if (response["listaExpendable"] != null) {
                            var myArray = response["listaExpendable"]
                            var myFinalString = ""
                            for (let word in myArray) {
                                myFinalString += myArray[word]
                                myFinalString += "</br>"
                            }
                            console.log("myFinalString",myFinalString)
                            $('#listPartNumbersExpendable').html(myFinalString);
                        }
                        else{
                            $('#listPartNumbersExpendable').html(null);
                        }
                    }
                })
            });

            $('#configs tbody').on('click', '#returnable', function () {
                var data = table.row($(this).parents('tr')).data();
                console.log("returnable"+data)

                var idPacote = data[9]

                $.ajax({
                    type: 'GET',
                    url: '/packing/getPNReturnable',
                    data: {
                        idPacote: idPacote,
                    },
                    success: function (response) {
                        console.log(response)
                        var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersReturnable'))
                        myModal.show()
                        if (response["listaReturnable"] != null) {
                            console.log("entrou no if")
                            var myArray = response["listaReturnable"].split(",")
                            var myFinalString = ""
                            for (let word in myArray) {
                                myFinalString += myArray[word]
                                myFinalString += "</br>"
                            }
                            $('#listPartNumbersReturnable').html(myFinalString);
                        } else {
                            $('#listPartNumbersReturnable').html(null);
                        }
                    }
                })
            });

    
            $(document).on('click', '#savePNReturnable', function () {
                console.log("clicou no antigo returnable")
                var todosReturnable = []
                let todosReturnableFinal = ""
                $.each(tableReturnable.rows('.selected').nodes(), function (i, item) {
                    var data = tableReturnable.row(this).data();
                    console.log(data[1])
                    todosReturnable.push(data[1])
                });
                //alert("Part numbers:  " + todosExpendable);

                for (let member in todosReturnable) {
                    todosReturnableFinal += todosReturnable[member]
                    todosReturnableFinal += ","
                }

                var pacote = document.getElementById('idPacote').value
                var oemEdit = document.getElementById('oemEdit').value
                var produtoEdit = document.getElementById('produtoEdit').value
                var embalagemEdit = document.getElementById('embalagemEdit').value
                var supplyTimeEdit = document.getElementById('supplyTimeEdit').value

                $.ajax({
                    type: 'POST',
                    url: '/packing/savePNReturnable',
                    data: {
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                        idReturnable: pacote,
                        listaPNReturnable: todosReturnableFinal
                    },
                    success: function () {
                        $("#partNumbersReturnable").hide();
                        $("#updateLinha").hide();
                        $(".modal-backdrop").remove();

                        $.ajax({
                            type: 'GET',
                            url: '/packing/getPNReturnable',
                            data: {
                                idPacote: pacote,
                            },
                            success: function (response) {
                                global_listaReturnable = response["listaReturnable"]
                                console.log("success")
                                $.ajax({
                                    type: 'GET',
                                    url: '/packing/getPNExpendable',
                                    data: {
                                        idPacote: pacote,
                                    },
                                    success: function (response) {
                                        global_listaExpendable = response["listaExpendable"]
                                        console.log("success")
                                        var myModal = new bootstrap.Modal(document.getElementById('updateLinha'))
                                        myModal.show()

                                        var modalInfo = "<p>" + "Client:&emsp;&emsp;" + oemEdit + "</p>" +
                                            "<p>" + "Product: &emsp;" + produtoEdit + "</p>" +
                                            "<p>" + "Package:&emsp;" + embalagemEdit + "</p>" +
                                            "<p>" + "Supply time:&emsp;<b>" + supplyTimeEdit + "</b></p>" +
                                            "<p>" + "Part number Returnable:&emsp;" + global_listaReturnable + "</p>" +
                                            "<p>" + "Part number Expendable:&emsp;" + global_listaExpendable + "</p>"

                                        $('#infoEdit').html(modalInfo);
                                        $('#oemEdit').val(oemEdit);
                                        $('#produtoEdit').val(produtoEdit);
                                        $('#embalagemEdit').val(embalagemEdit);
                                        $('#supplyTimeEdit').val(supplyTimeEdit);
                                    }
                                })
                            }
                        })
                    }
                })
            });

          /* FUNC QUE VAI ENVIAR PARA A VIEW O FILE PARA SER LIDO  
           function uploadStockPackage() {
            console.log("Button upload")
            var data = new FormData()
            var file = $("#myfile")[0].files[0]
            data.append("myfile", file)
            data.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val())

            console.log("Seding API REQ")
            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:uploadStockFile' %}",
                processData : false,
                contentType : false,
                data: data,
                success: function () {
                    console.log("[API] Callback to the endpoint sucess")
                },
                complete: function () {
                    window.location.reload()
                }
            })
        }
 */
/* 
        $(document).on('click', '#excel', function () {
            window.location.replace("{% url 'pManagement:downloadExcelStockPackage' %}")
        });
 */
    </script>
{% endblock %}