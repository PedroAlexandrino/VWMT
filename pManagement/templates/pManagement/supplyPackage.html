{% extends "vware/baseArmazem.html" %}
{% load static %}
{% load utils %}

{% block body_title %}
<style>
    .button {
        height: 70px;
       
        font-family: Arial, "Helvetica", sans-serif;
        font-size: 45px;
        color: #fff;
        text-decoration: none;
        text-align: center;
        text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
        padding-top: 6px;
        margin-left: auto;
        margin-right: auto;
        left: 30px;
        position: relative;
        cursor: pointer;
        border: none;
        background: #FBA51A;
        background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
        border-radius: 5px;
        box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;
   
    }

    .buttons{
        padding: 15px 25px;
        background: #FBA51A;
        text-align: center;
        padding-top: 6px;
        font-size: 15px;
        width: 100px; 
        margin-left: 8px"
    }

    .buttonAddClient{
        height: 25px;
       
       font-family: Arial, "Helvetica", sans-serif;
       font-size: 15px;
       color: #fff;
       text-decoration: none;
       text-align: center;
       text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
       padding-top: 6px;
       margin-left: auto;
       margin-right: auto;
       left: 30px;
       position: relative;
       cursor: pointer;
       border: none;
       background: #FBA51A;
       background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
       border-radius: 5px;
       box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;
  
    }
    

    .buttonsUpdate1{
        position: relative;
        right:    0;
        bottom:   35px;
        padding: 5px 10px;
        background: #FBA51A;
        text-align: center;
        font-size: 15px;
        margin: 0;
        width: 5%;
        height: auto;
        margin-left: 81%;
        
    }
    .buttonsUpdate2{
        position: relative;
        right:    0;
        bottom:   70px;
        padding: 5px 10px;
        background: #FBA51A;
        text-align: center;
        font-size: 15px;
        margin: 0;
        width: 5%;
        height: auto;
        margin-left: 81%;
    }
    .buttonsPaginator{
        position: relative;
        padding: 5px 10px;
        background: #FBA51A;
        text-align: center;
        
    }

    .containerPrincipal {
            height: 70%;
            width: 100%;
            top: 11px;
            left: 0px;
            position: relative;
            border-bottom: 3px solid transparent;
        }

    .containerSecundario {
        height: 30%;
        width: 100%;
        top: 75%;
        left: 0px;
        position: relative;
        border: 3px solid transparent;
    }

    .custom_link:hover {
        color: rgb(27, 50, 255);
    }
  

 </style>
    <div class="text-primary" xmlns="http://www.w3.org/1999/html">
        <h6><b><i class="fa fa-home text-secondary"></i><a href={% url 'main:main' %}><span
                class="text-secondary"> Home | </span></a> Supply Package</b></h6>
    </div>
{% endblock %}


{% block body_content %}
<p></p>
<div class="containerPrincipal">
            <table id="example" class="stripe hover cell-border " style="width:100%">
                <thead>
                <tr>
                    <td>Part-number</td>
                    <td>Description</td>
                    <td>Comment</td>
                    <td>
                        <div class="text-center fas fa-square">Client Package</div>
                    </td>
                    <td>
                        <div class="text-center far fa-square"></div>
                        Stock Package
                    </td>
                    <td>
                        <div class="fas fa-stopwatch">Suply Time</div>
                    </td>
                    <td>Stock</td>
                    <td>Inventory</td>
                    <td>Link</td>
                    <td></td>
                    <td style="display: none"></td>
                    
                </tr>
                </thead>
                <tbody>
                    
                        {%for kitSuplyPackage in kitSuplyPackage.all%}
                            <tr>
                                <td title="{{ kitSuplyPackage.part_number|default:'Empty'}}">{{ kitSuplyPackage.part_number }}</td>
                                <td title="{{ kitSuplyPackage.description|default:'Empty'}}">{{ kitSuplyPackage.description }}</td>
                                <td title="{{ kitSuplyPackage.comment|default:'Empty'}}">{{ kitSuplyPackage.comment }}</td> 
                                
                                <td>
                                    <button type="button" class="btn btn-success" id="ClientePackageButton" style="background-color: #FBA51A; margin-left: 30%">
                                        <li class="fa fa-plus fa-fw"></li>
                                    </button>
                                </td>


                                <td>
                                    <button type="button" class="btn btn-success" id="StockPackageButton" style="background-color: #FBA51A; margin-left: 30%">
                                        <li class="fa fa-plus fa-fw"></li>
                                    </button>
                                </td>

                                <td>{{ kitSuplyPackage.supply_time }}</td>
                                <td class="text-center">{{ kitSuplyPackage.stock }}</td>
                                <td><input style="width: 70px; margin-left: 8px" class=""
                                    type="number"
                                    name="{{ kitSuplyPackage.id }}" min="0" id="{{ kitSuplyPackage.id }}"
                                    value="{{ kitSuplyPackage.inventario|default:'0'}}"></td>
                                        
                                <td style="width: 5%" id="link"><a style="color: rgb(27, 50, 255)">{{ kitSuplyPackage.link }}</a></td>
                                <td>
                                    <div class="form-inline">
                                        <a type="button"  id="botaoEdit" title="edit" class="fas fa-pen-square"
                                        style="height: 18px; margin-left: 10px"
                                        data-toggle="modal" data-target="#updateLinha">
                                        </a>
                                        <a type="button" id="botaoDelete" title="delete" class="fas fa-trash-alt"
                                        style="height: 18px; margin-left: 15px"
                                        data-toggle="modal" data-target="#deleteLinha">
                                        </a>
                                    </div>
                                </td>
                                <td style="display: none" value="{{ kitSuplyPackage.id }}">{{ kitSuplyPackage.id }}</td>
                            </tr>  
                {% endfor %}  
                </tbody>
                <tfoot>
                <tr>
                    <th>Part-number</th>
                    <th>Descrição</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th style="text-align: center"> 
                        <button type="button" title="Update"    class="btn btn-primary btn btn-primary" data-toggle="modal" style="background: #FBA51A;" onclick="botaoUpdateInventario()" > Update </button></th> <!-- Stock -->
                    <th style="text-align: center"> 
                        <button   title="Gravar" type="submit"   class="btn btn-primary"id ="botaoUpdateStocks" style="background: #FBA51A;" onclick="botaoUpdateStock()" > Gravar </button>
                    </th>  <!-- Inv -->
                    <th></th>
                    <th></th>
                    <th style="display: none"></th>
                </tr>
                </tfoot>
            </table>
            </div>
                <div style="width: 30%; margin-left: 30%; bottom: -10%; position: absolute; border: 3px solid transparent; text-align: center">
                    <button type="submit" class="button"  data-toggle="modal"
                            data-target="#addLinha">
                        NOVO ITEM
                    </button>
                </div>

                <div style="position: absolute; bottom: -5%; margin-left: 1%">
                    <button type="button" class="form-control" style="background-color: lightgrey" id="excel">Excel</button>
                </div>
                    <!-- <button type="button"  title="Download Excel" class="btn btn-primary buttons"  onclick="uploadStockPackage()" style="background-color: #21127251" id="excel">Excel</button> -->
                    <!-- vai haver um btn para dar upload do excel -->
                            <form method="POST" class="form" action="{% url 'pManagement:updateAllStockSupplyPackage' %}?page="(current_page)
                            enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="modal fade" id="updateStocks" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h3 class="modal-title" id="myModalLabel"><b>Deseja fazer Update ao Stock?</b></h3>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                                    aria-hidden="true">&times;</span></button>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Não</button>
                                            <button onclick="botaoUpdateInventario()" type="submit" class="btn btn-primary">Sim</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div class="form-inline" style="width: 570px">
                        <h4 class="mt-3">IMPORT XLSX FILE:</h4>
                        <input style="margin-left: 20px; margin-top: 1px" type="file" name="myfile" id="myfile"
                                title="Choose File"></br>
    </div>
     
      <button title="Upload Excel" class="btn btn-outline-primary" style="margin-left: 154px" onclick="uploadStockPackage()" type="submit">
          Upload
      </button>

    <!-- Modal onde é adicionada uma nova linha -->
      <form id="createSupplyPkg">
        {% csrf_token %}
        <div class="modal fade" id="addLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="myModalLabel"><b>Create new row</b></h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-inline">
                            <p class="mt-2">Package Part number: </p>
                            <input style="margin-left: 20px" type="text" id="pnAdd" name="pnAdd" value="{{ kitSuplyPackage.part_number}}"required>
                        </div>
                  
                        <div class="form-inline">
                            <p class="mt-2">Package desctription: </p>
                            <input style="margin-left: 21px" type="text" id="supplyDescriptionAdd" name="prodDescriptionAdd"
                                   value="{{ kitSuplyPackage.description }}"required>
                        </div>
                        <div class="form-inline">
                            <p class="mt-2">Comment: </p>
                            <input style="margin-left: 85px" type="text" id="supplyCommentAdd" name="prodCommentAdd"
                                   value="{{ kitSuplyPackage.comment }}">
                        </div>
                        <div class="form-inline">
                            <p class="mt-2">Supply Time </p>
                            <select style="margin-left: 73px; width: 160px" name="supplyTimeAdd" id="supplyTimeAdd"required>
                                <option value=""></option>
                                <option value="30">30</option>
                                <option value="60">60</option>
                                <option value="90">90</option>
                                <option value="120">120</option>
                                <option value="150">150</option>
                                <option value="180">180</option>
                                <option value="210">210</option>
                                <option value="240">240</option>
                            </select>
                        </div>
                       
                        <div class="form-inline">
                            <p class="mt-2">Stock: </p>
                            <input style="margin-left: 110px" type="number" min="0" id="supplyStockAdd" name="prodStockAdd"
                                   value="{{ kitSuplyPackage.inventario}}"required>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Link: </h6>
                                   <input type="file"  style="margin-left: 115px" name="novoLinkEdit"  id="novoLinkEdit" value="{{ stock_package.link }}"/>
                        </div>
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Clients: </h6> <!-- partNumbersExpendable -->
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#partNumbersExpendable"style="background-color: #FBA51A;margin-left: 95px">
                                <li class="fa fa-plus fa-fw"></li> Open
                            </button>
                        </div>
                       
                        <div class="form-inline mt-3">
                            <h6 class="mt-1">Stock Packages: </h6>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#partNumbersReturnable"style="background-color: #FBA51A; margin-left: 44px">
                                <li class="fa fa-plus fa-fw"></li> Open
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div style="width: 50%; margin-right: 36%; bottom: 2%; position: absolute; border: 1px solid transparent; text-align: center">
                            <button type="submit" class="buttonAddClient" data-toggle="modal"
                                    data-target="#addClientPackage">
                                NOVO CLIENTE
                            </button>
                    </div>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </div>
              

                    
                </div>
               
        </div>
    </form>

    <!-- Modal onde é feito o delete de uma linha especifica -->
    <form method="POST" class="form" action="{% url 'pManagement:deleteSuplyPackage' %}"
          enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal fade" id="deleteLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="myModalLabel"><b>Delete this row?</b></h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <p id="infoDelete"></p></br>
                        
                        <input type="hidden" id="rowIdDelete" name="rowIdDelete" value="{{rowIdDelete}}">
                       
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="modal fade" id="deleteLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Delete this row?</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="infoDelete"></p></br>
                    
                    <input type="hidden" id="rowIdDelete" name="rowIdDelete" value="{{rowIdDelete}}">
                   
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal onde é feito EDIT de cada linha -->
<form id="editSupplyPkg">
    {% csrf_token %}
    <div class="modal fade" id="updateLinha" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Edit Row</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>

                </div>
                <div class="modal-body">
                    <input type="hidden" id="rowIdUpdate" name="rowIdUpdate" value="{{ rowIdUpdate }}">
                    <h3><b>Replace by: </b></h3>
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Part Number: </h6>
                        <input placeholder="New description" type="form" name="novoPartNumberEdit"
                                id="novoPartNumberEdit" style="margin-left: 21px; width: 300px"  value="{{ kitSuplyPackage.part_number}}" required>
                    </div>
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Description: </h6>
                        <input placeholder="New description" type="form" name="novoDescriptionEdit"
                                id="novoDescriptionEdit" style="margin-left: 25px; width: 300px"  value="{{ kitSuplyPackage.description }}"required>
                    </div>
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Comment: </h6>
                        <input placeholder="New Comment" type="form" name="novoCommentEdit"
                                id="novoCommentEdit" style="margin-left: 36px; width: 300px"  value="{{ kitSuplyPackage.comment }}">
                    </div>
                    
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Quantity: </h6>
                        <th style="width: 5%" id="novoStockProdutoEdit" name="novoStockProdutoEdit" title="{{ kitSuplyPackage.inventario|default:'Empty' }}">
                            <input style="width: 70px; margin-left: 40px" min="0" class="" 
                            type="number"
                            name="novoStockProdutoEdit" id="novoStockProdutoEdit"
                            value="{{ kitSuplyPackage.inventario|default:"" }}" required>
                        </th>
                    </div>
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Supply Time: </h6>
                        <select style="margin-left: 20px" name="novoSupplyTimeEdit" id="novoSupplyTimeEdit"required>
                            <option value=""></option>
                            <option value="30">30</option>
                            <option value="60">60</option>
                            <option value="90">90</option>
                            <option value="120">120</option>
                            <option value="150">150</option>
                            <option value="180">180</option>
                            <option value="210">210</option>
                            <option value="240">240</option>
                        </select>
                    </div>
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Link: </h6>
                                <td><input type="file"  style="margin-left: 67px;" name="novolinkEdit"  id="novolinkEdit" value="{{ kitSuplyPackage.link }}"/></td>
                    </div>
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Client Product: </h6> <!-- partNumbersExpendable -->
                        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#partNumbersExpendable"style="background-color: #FBA51A; margin-right: 10px"> 
                            <li class="fa fa-plus fa-fw"></li> Open
                        </button>
                    </div>
                    
                    <div class="form-inline mt-3">
                        <h6 class="mt-1">Stock Packages: </h6>
                        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#partNumbersReturnable"style="background-color: #FBA51A;margin-left: 5px">
                            <li class="fa fa-plus fa-fw"></li> Open
                        </button>
                    </div>
                    <!-- <td style="display: none" id="rowIdUpdate" name="rowIdUpdate" value="{{ rowIdUpdate }}"></td> -->
                    <!-- <td style="display: none" value="{{ kitSuplyPackage.id }}">{{ kitSuplyPackage.id }}</td> -->
                    <td style="display: none" value="{{ kitSuplyPackage.id }}">{{ kitSuplyPackage.id }}</td>
                </div>
                <div class="modal-footer">
                    <button type="button" class="buttonAddClient" data-toggle="modal"
                                data-target="#addClientPackage">
                            NOVO CLIENTE
                        </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
                
            </div>
            
        </div>
    </div>
</form>

<!-- Por como form para dar os erros de "empty" -->
    <form id="CreateCliente">
        {% csrf_token %}
<div class="modal fade" id="addClientPackage" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="myModalLabel"><b>New Client/Product</b></h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>

            </div>
            <div class="modal-body">
                <table class="table table-borderless mb-n1">
                  <thead></thead>
                  <tbody>
                    <div class="form-inline">
                      <p class="mt-2">Cliente</p>
                      <input list="clientList" id="getCliente" name="getCliente"required/>
                      <datalist id="clientList">
                        {% for clientes in ClientesOEM.all %}
                        <option value="{{clientes.oem}}" ></option>
                        {% endfor %}
                      </datalist>
                      
    
                       
                    </div>
                    <div class="form-inline mt-3">
                      <h6 class="mt-1" >Product:</h6>
                      <input list="prodList" id="getProds" name="getProds" required />
                      <datalist id="prodList">
                        {% for produtos in Produtos.all %}
                        <option value="{{produtos.nome}}"></option>
                        {% endfor %}
                      </datalist>
                    </div>
                    {% if erro %}
                    <div class="text-center mb-n2">
                      <b>{{ erro }}</b>
                    </div>
                    {% endif %}
    
                    <tr></tr>
    
                    <tr>
                      <th scope="row" style="color: black">
                        <h6><b>Comment</b></h6>
                      </th>
                      <td>
                        <input type="text" name="newComment" id="newComment" />
                      </td>
                    </tr>
                  </tbody>
                </table>
                {% if erro2 %}
                <div class="text-center">
                  <b>{{ erro2 }}</b>
                </div>
                {% endif %}
              
                
                <!-- <td style="display: none" id="rowIdUpdate" name="rowIdUpdate" value="{{ rowIdUpdate }}"></td> -->
                <!-- <td style="display: none" value="{{ kitSuplyPackage.id }}">{{ kitSuplyPackage.id }}</td> -->
                <td style="display: none" value="{{ kitSuplyPackage.id }}">{{ kitSuplyPackage.id }}</td>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary"  id="CreateButtonNew">Save changes</button>
            </div>
        </div>
    </div>
</div>
</form>
    <!-- tabelas dos clicaveis -->
    <!-- Clicavél da tablea -->

    <div class="modal fade" id="partNumbersExpendable" data-backdrop="false" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title" id="myModalLabel"><b>Cliente Package:</b></h3>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                       aria-hidden="true">&times;</span></button>
           </div>
           <div class="modal-body">
               <p id="infoLinhaExpendable"></p></br>
               <div class="containerPrincipal">
               <table id="pnExpendableTable" class="display" style="width: 100%">
                   <thead>
                   <tr>
                       <td></td>
                       <th>Nome do Cliente</th>
                       <th>Nome do Produto</th>
                       <th>Prod Comentario</th>
                       <th></th>
                       <th></th>
                   </tr>
                   </thead>
                   <tbody>
                   {% for pn in cliente_produto.all %}
                    <tr>
                        <td></td>
                        <td>{{ pn.cliente.oem }}</td>
                        <td>{{ pn.produto.nome }}</td>
                        <th>{{ pn.comment }}</th>
                        <th></th>
                        <td style="display: none">{{ pn.id }}</td>
                    </tr>
                   {% endfor %}
                   </tbody>
                   <tfoot>
                   <tr>
                       <td></td>
                       <td></td>
                       <th></th>
                       <th></th>
                       <td></td>
                       <td></td>
                       
                   </tr>
                   
                   </tfoot>
               </table>
               </div><div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <!-- <button type="submit" id="savePNExpendable" class="btn btn-primary">Save</button> -->
            </div>
           </div>
          
        </div>
        
           
           <!-- ADD BTN AQUI -->
        
       </div>
       
    </div>
    </div>

    <div class="modal fade" id="partNumbersReturnable" data-backdrop="false" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Part numbers Stock Package</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="infoLinhaReturnable"></p></br>
                    <table id="pnReturnable" class="display" style="width:100%">
                        <thead style="width:100%">
                        <tr>
                            <th></th>
                            <th>Part numbers</th>
                            <th>Description</th>
                            <th style="display: none"></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for pn in stock_package_parts.all %}
                            <tr>
                                <td></td>
                                <td> {{ pn.pn }} </td>
                                <td> {{ pn.descricao }} </td>
                                <td style="display: none"> {{ pn.id }} </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot>
                        <tr>
                            <td></td>
                            <th></th>
                            <td></td>
                            <td></td>
                        </tr>
                        <div class="modal-footer">
             <!--   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
               <!-- <button type="submit" id="savePNExpendable" class="btn btn-primary">Save</button> -->
           </div>
                        </tfoot>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <!-- <button type="submit" id="savePNReturnable" class="btn btn-primary">Save</button> -->
                </div>
            </div>
        </div>
    </div>

<!-- TABELA QUE VAI MOSTRAR OS CLIENTES/PRODUTO QUE ESTÂO AGREGADOS A UM CERTO SUPPLYPACKAGE -->
    <div class="modal fade" id="listaClientProd" data-backdrop="false" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title" id="myModalLabel"><b>Cliente Produto</b></h3>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                       aria-hidden="true">&times;</span></button>
           </div>
           <div class="modal-body">
               <p id="listaLinhaReturnable"></p></br>
               
               <table id="ListaClientes" class="stripe hover cell-border" style="width:100%">
                   <thead>
                    <tr>
                        <th style="text-align: center">Clients</th>
                        <th style="text-align: center">Products</th>
                        <th style="text-align: center">Comment</th>
                      
                    </tr>
                   </thead>
                   <tbody>
                    </tr>
                        <td></td>
                        <td></td>
                        <td></td>
                         
                    </tr>
                    </tbody>
                   <tfoot>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                       
                    </tr>
                   </tfoot>
               </table>
              
           </div>
           <div class="modal-footer">
               <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
           </div>
       </div>
    </div>
    </div>

    <!-- TABELA PARA O STOCKPACKAGE QUE VAI RECEBER UM ID E VAI MOSTRAR TODOS OS STOCKS PACKAGES SELECIONADOS ANTERIORMENTE -->
<div class="modal fade" id="listaStockPackage" data-backdrop="false" tabindex="-1" role="dialog"
aria-labelledby="myModalLabel">
<div class="modal-dialog" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <h3 class="modal-title" id="myModalLabel"><b>Products</b></h3>
           
       </div>
       <div class="modal-body">
           <p id="listaLinhaReturnable"></p></br>
           <table id="listaPnReturnable" class="stripe hover cell-border" style="width:100%;">
               <thead>
                <tr>
                    <th style="text-align: center">Part Number</th>
                    <th style="text-align: center">Description</th>
                    <th style="text-align: center">Stock</th>
                    <th style="text-align: center">Type</th>
                   
                </tr>
               </thead>
               <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  
                </tr>
                </tbody>
               <tfoot>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                     
                    </tr>
               </tfoot>
           </table>
       </div>
       <div class="modal-footer">
           <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
       </div>
   </div>
</div>
</div>


<!-- Clicavéis da tabela (btn azul) (antigo, foi substituido pelas tabelas)-->

    <div class="modal fade" id="showPartNumbersExpendable" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Client Package:</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="listPartNumbersExpendable"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="showPartNumbersReturnable" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="myModalLabel"><b>Stock Package:</b></h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <p id="listPartNumbersReturnable"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

      
  

{% endblock %}

{% block javascript %}
    <script>
        
        $('.clearable.example .ui.selection.dropdown')
            .dropdown({
                clearable: true
            })
        ;
        $('.clearable.example .ui.inline.dropdown')
            .dropdown({
                clearable: true,
                placeholder: 'any'
            })
        ;

/* $(document).on('click', '#CreateSubmiteButton', function () { */
    function CreateSubmiteButton(scope){
    var elem = document.getElementById("CreateButtonNew")//Ver o id do btn(save)
    elem.disabled = true
    var pnAdd = $("#pnAdd").val()
    var supplyDescriptionAdd = $("#supplyDescriptionAdd").val();
    var supplyCommentAdd = $("#supplyCommentAdd").val();
    var supplyTimeAdd = $("#supplyTimeAdd").val();
    var supplyStockAdd = $("#supplyStockAdd").val();
    var novoLinkEdit = document.getElementById("novoLinkEdit").files[0]//$("#novoLinkEdit").val();
    var clients = []
    var stockPackages = []
    var tableReturnable = $('#pnReturnable').DataTable()
    var tableExpendable = $('#pnExpendableTable').DataTable()

    $.each(tableReturnable.rows('.selected').nodes(), function (i, item) {
        var data = tableReturnable.row(this).data();
        console.log("tableReturnable", data);
        stockPackages.push(data[3])
    });
    console.log("stockPackages ",stockPackages)

    $.each(tableExpendable.rows('.selected').nodes(), function (i, item) {
        var data = tableExpendable.row(this).data();
        console.log("tableExpendable", data);
        clients.push(data[5])
    });
    console.log("VALUES", pnAdd,supplyDescriptionAdd,supplyCommentAdd,supplyStockAdd)
    console.log("StockPackage/ Clientes", stockPackages,clients)
    var elem = document.getElementById("CreateButtonNew")
            elem.disabled = true
    var dataForm = new FormData();
    dataForm.append(
        "pnAdd", pnAdd
    )
    dataForm.append(
        "prodDescriptionAdd", supplyDescriptionAdd
    )
    dataForm.append(
        "prodCommentAdd", supplyCommentAdd
    )
    dataForm.append(
        "supplyTimeAdd", supplyTimeAdd
    )
    dataForm.append(
        "prodStockAdd", supplyStockAdd
    )
    dataForm.append(
        "novoLinkEdit", novoLinkEdit
    )
    dataForm.append(
        "clients", clients
    )
    dataForm.append(
        "stockPackages", stockPackages
    )
    dataForm.append(
        "csrfmiddlewaretoken", $("input[name=csrfmiddlewaretoken]").val()
    )
  
    $.ajax({
            type: 'POST',
            url: "{% url 'pManagement:addRowSupplyPackage' %}",
            contentType: false,
            processData: false,
            data: dataForm,
            success: function () {
                console.log("[API] Callback to the endpoint sucess")
                elem.disabled = false
                return true;
            },
            complete: function () {
                return true;
                elem.disabled = false
                window.location.reload()
            }
        }) 
};

/* $(document).on('click', '#EditRowButton', function () { */
function EditRowButton(scope) {
    console.log("Doing the edit callback.")
    var rowIdUpdate = $("#rowIdUpdate").val()
    var novoPartNumberEdit = $("#novoPartNumberEdit").val()
    var novoDescriptionEdit = $("#novoDescriptionEdit").val()
    var novoCommentEdit = $("#novoCommentEdit").val()
    var novoStockProdutoEdit = $("#novoStockProdutoEdit").val()
    var novoSupplyTimeEdit = $("#novoSupplyTimeEdit").val()
    var novolinkEdit = document.getElementById("novolinkEdit").files[0]
    var clients = []
    var stockPackages = []
    var tableReturnable = $('#pnReturnable').DataTable()
    var tableExpendable = $('#pnExpendableTable').DataTable()

 /*    if(novoPartNumberEdit=="" || novoPartNumberEdit == undefined){
        return alert("Deve introduzir um Part-Number");
    }
    if(novoStockProdutoEdit <0){
        return alert("O stock deve ser um valor positivo")
    }
    if(novolinkEdit == undefined || novolinkEdit == ""){
                alert("Link vazio")
            }
            else{
                if(!novolinkEdit.name.endsWith("pptx")){
                return alert("Not a valid file");
            }
        } */

    console.log("DADOS->", rowIdUpdate,novoPartNumberEdit,novoDescriptionEdit,novoStockProdutoEdit,novoSupplyTimeEdit,novoLinkEdit)
    $.each(tableReturnable.rows('.selected').nodes(), function (i, item) {
        var data = tableReturnable.row(this).data();
        console.log("tableReturnableasd", data);
        stockPackages.push(data[3])
    });

    $.each(tableExpendable.rows('.selected').nodes(), function (i, item) {
        var data = tableExpendable.row(this).data();
        console.log("tableExpendablesade", data);
        clients.push(data[5])
    });

    console.log("CLIENTES",clients)
    console.log("STOCKPACK",stockPackages)

    if(!novoPartNumberEdit.length){
        return alert("Part-number is not valid")
    }
    if(novoStockProdutoEdit < 0){
        return alert("You must set a valid Stock")
    }
    if(novoSupplyTimeEdit < 0){
        return alert("You must set a valid Supply-Time")
    }

    var dataForm = new FormData();
    dataForm.append(
        "rowIdUpdate", rowIdUpdate
    )
    dataForm.append(
        "novoPartNumberEdit", novoPartNumberEdit
    )
    dataForm.append(
        "novoDescriptionEdit", novoDescriptionEdit
    )
    dataForm.append(
        "novoCommentEdit", novoCommentEdit
    )
    dataForm.append(
        "novoStockProdutoEdit", novoStockProdutoEdit
    )
    dataForm.append(
        "novoSupplyTimeEdit", novoSupplyTimeEdit
    )
    dataForm.append(
        "novolinkEdit", novolinkEdit
    )
    dataForm.append(
        "clients", clients
    )
    dataForm.append(
        "stockPackages", stockPackages
    )
    dataForm.append(
        "csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val()
    ) 

    
    $.ajax({
            type: 'POST',
            url: "{% url 'pManagement:updateSupplyPackage' %}",
            contentType: false,
            processData: false,
            data: dataForm,
            success: function () {
                console.log("[API] Callback to the endpoint sucess")
                window.location.reload()
            },
            complete: function () {
            }
        }) 
}
        
 function CreateClienteSubmiteButton(scope) {
    var newComment = $("#newComment").val();
    var clienteAdd = $("#getCliente").val();
    var produtos =  $("#getProds").val();
    var tableExpendable = $('#tableExpendable').DataTable();

    $.ajax({
        type: 'POST',
        url: "{% url 'pManagement:createClienteProduto' %}",
        data: {
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            newClient : clienteAdd,
            newProd : produtos,
            newComment: newComment,
        },
        success: function (resp) {
            console.log(resp)
            console.log("Chegou ao  DRAW")
            tableExpendable.row.add(
                ["", clienteAdd, produtos, newComment, "", resp["id"]]
            ).draw()//BUG tabela não esta visivél aqui
            console.log("PASSOU O DRAW")
            $("#addClientPackage").modal('hide');
            console.log("[API] Callback to the endpoint sucess")
        },
    })
}
  


$(document).ready(function () {
    $("#createSupplyPkg").submit((ev) => {
        console.log("createSupplyPkg")
        ev.preventDefault()
        CreateSubmiteButton($(this))
    })

    $("#editSupplyPkg").submit((ev) => {
        console.log("editSupplyPkg")
        ev.preventDefault()
        EditRowButton($(this))
    })

    $("#CreateCliente").submit((ev) => {
        console.log("CreateCliente")
        ev.preventDefault()
        CreateClienteSubmiteButton($(this))
    })

   /*  $('#example tbody').on('click', '#linka', function () {
        var data = table.row($(this).parents('tr')).data();
        var link = data[8]
        
         if(link==""){
            return alert("Este campo não tem link")
        }
        var popup = confirm("Deseja abrir o ficheiro?")
        console.log(popup)
        if (popup == true) {
            console.log("true")
            window.open("{% url 'pManagement:pdf_view' %}?link=" + link, '_blank').focus();
        } else {
            console.log("false")
            window.open("{% url 'pManagement:pdf_view1' %}?link=" + link, '_blank').focus();
        }
    
}); */

$('#example tbody').on('click', '#link', function () {
    var data = table.row($(this).parents('tr')).data();
    var link = $(data[8]).html()
    if(link == "" || link == undefined){return}

    const DefaultMixinCss = Swal.mixin({
        customClass: {
            confirmButton: 'btn btn-primary',
            cancelButton: 'btn btn-danger'
        },
        buttonsStyling: false
    }).fire({
        title: 'Are you sure you want to continue?',
        showCancelButton: true,
        confirmButtonText: 'Yes',
        cancelButtonText: `No`,
        }).then((result) => {
        if (result.isConfirmed) {
            window.open("{% url 'pManagement:pdf_view1' %}?link=" + link, '_blank').focus();
        }
    })
});



// --------- Defenição de DataTabales --------- //

var table = $('#configs').DataTable({
    "info": false,
    "scrollY": "594",
    "paging": false,
    "ordering": false,
    "orderCellsTop": true,
    "fixedHeader": true,

    select: {
        style: 'os',
        selector: 'th:first-child',
        blurable: true
    },
    
    order: [[0, 'asc']],

    initComplete: function () {
        
        this.api().columns([0, 1, 2]).every(function () {
            console.log("AO CARREGAR A PAGINA OS FILTROS");
            var column = this;
            var select = $('<select class="form-control" style="margin-left: -9px" id="selected"><option value=""></option></select>')
                .appendTo($(column.footer()).empty())
                .on('change', function () {
                    var val = $.fn.dataTable.util.escapeRegex(
                        $(this).val()
                    );
                    //pode ser daqui o erro, não está a conseguir chegar ao spot
                    column
                        .search(val ? '^' + val + '$' : '', true, false)
                        .draw();
                });

            column.data().unique().sort().each(function (d, j) {
                console.log("NESTE BLOCO MOSTRA INFOS DOS FILTOS EM BAIXO DA ROW 1/3"+ d)
                select.append('<option value="' + d  + '">' + d + '</option>')
            });
        });
    },
});

var tableReturnable = $('#pnReturnable').DataTable({    
    "info": false,
    "paging": false,
    "scrollCollapse": true,
    "scrollY": "420px",
    columnDefs: [{
        orderable: false,
        className: 'select-checkbox',
        targets: 0
    }],
    select: {
        style: 'multi',
        selector: 'td:first-child'
    },
    
    order: [[1, 'asc']],
    initComplete: function () {

        this.api().columns([1]).every(function () {
            var that = this;


            //$('#pnReturnable tfoot tr').appendTo('#pnReturnable thead');   // To displays the search boxs at the top instead to the bottom of the table
            $('input', this.footer()).on('keyup change clear', function () {
                console.log("print6")
                if (that.search() !== this.value) {
                    that
                        .search(this.value)
                        .draw();
                }
            });
        });
    }
});

var tableExpendable = $('#pnExpendableTable').DataTable({
    "info": false,
    "paging": false,
    "scrollCollapse": true,
    "scrollY": "420px",
    columnDefs: [{
        orderable: false,
        className: 'select-checkbox',
        targets: 0,
    }],
    select: {
        style: 'multi',
        selector: 'td:first-child'
    },
    order: [[1, 'asc']],

    initComplete: function () {
        this.api().columns([1]).every(function () {
            
            var that = this;
            //$('#pnExpendable tfoot tr').appendTo('#pnExpendable thead');   // To displays the search boxs at the top instead to the bottom of the table
            $('input', this.footer()).on('keyup change clear', function () {
                console.log("print10")
                if (that.search() !== this.value) {
                    that
                        .search(this.value)
                        .draw();
                }
            });
        });
    }
});

var listaClientes = $("#ListaClientes").DataTable({
    "info": false,
    
    "paging": false,
    "ordering": false,
    "orderCellsTop": true,
    "fixedHeader": true,
    select: {
        style: 'os',
        selector: 'th:first-child',
        blurable: true
    },

    order: [[0, 'asc']],
})

var listaPnReturnable = $("#listaPnReturnable").DataTable({
    "info": false,
     
    "paging": false,
    "ordering": false,
    "orderCellsTop": true,
    "fixedHeader": true,
    select: {
        style: 'os',
        selector: 'th:first-child',
        blurable: true
    },

    order: [[0, 'asc']],
})

// --------- Fim Da Defenição de DataTabales --------- //



// Setup - add a text input to each footer cell
$('#example thead th').each(function (i) {
    var title = $('#example thead th').eq($(this).index()).text();
    $(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
});

    //Tabela do primeiro btn (ClientPackage)
    $('#pnReturnable tfoot th').each(function (i) {
                console.log("print5")
                var title = $('#pnReturnable tfoot th').eq($(this).index()).text();
                $(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
                console.log("print11");
            });
      
      /* TABELA do popup BOMB */
    $('#pnExpendableTable tfoot th').each(function (i) {
        console.log("AO CARREGAR A PAGINA  print4"+ " ");
               /* BUG */
              var title = $('#pnExpendable tfoot th').eq($(this).index()).text();
              
              console.log("teste"+title)
              $(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
             
          });
        
$(document).on("click", "#ClientePackageButton", function (e) {
    var data = table.row($(this).parents('tr')).data();
    let cliente_p;

    $("#listaClientProd").modal('show');
    $.ajax({
        type: 'GET',
        url: "{% url 'pManagement:get_cliente_produto_rel' %}",
        data: {
            Id: data[10],
        },
        success: function (resp) {
            console.log("Sucesso", resp["data"])
            cliente_p = resp["data"]
            listaClientes.clear()
            cliente_p.forEach(element => {
                listaClientes.row.add(
                    [
                        element["clienteproduto"]["cliente"]["oem"],
                        element["clienteproduto"]["produto"]["nome"],
                        element["clienteproduto"]["comment"],
                        element["id"]
                    ]
                )
            });
            listaClientes.draw()
},
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Error ao carregar os clientes...");
        }
    ,})
})


$(document).on("click", "#StockPackageButton", function (e) {
    var data = table.row($(this).parents('tr')).data();
    let cliente_p;

    $("#listaStockPackage").modal('show');
    $.ajax({
        type: 'GET',
        url: "{% url 'pManagement:get_stock_package_rel' %}",
        data: {
            Id: data[10],
        },
        success: function (resp) {
            console.log("Sucesso", resp["data"])
            cliente_p = resp["data"]
            listaPnReturnable.clear()
            cliente_p.forEach(element => {
                console.log("Element", element)
                listaPnReturnable.row.add(
                    [
                        element["stockpackage"]["pn"],
                        element["stockpackage"]["descricao"],
                        element["stockpackage"]["quantidade"],
                        element["stockpackage"]["tipo"],
                        element["id"],
                    ]
                )
            });
            listaPnReturnable.draw()
},
        error: function (jqXHR, textStatus, errorThrown) {
            alert("Error ao carregar os clientes...");
        }
    ,})
})



/* Clicavél da cell ClientPackage */
$(document).on('click', '#clientPackage', function () {
    console.log("returnable")
    var data = table.row($(this).parents('tr')).data();

    var idPacote = data[10]
    $.ajax({
        type: 'GET',
        url: '/packing/getPNExpendable',
        data: {
            idPacote: idPacote,
        },
        success: function (response) {
            var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersExpendable'))
            myModal.show()
            if (response["listaExpendable"] != null) {
                console.log("entrou no if")
                var myArray = response["listaExpendable"]
                var myFinalString = ""
                for (var key in myArray) {
                    for (var k in myArray[key]) {
                        myFinalString += "<strong>" + k + "</strong>" + ": " + myArray[key][k]
                        myFinalString += "</br>"
                    }
                    myFinalString += "\n<br></br>"
                }
                $('#listPartNumbersExpendable').html(myFinalString);
            } else {
                $('#listPartNumbersExpendable').html(null);
            }
        }
    })
});

$('#partNumbersReturnable').on('shown.bs.modal', function (e) {
    $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
});




        



/* Aqui trata do clicavél do (novo Item) o clientPackage */
        $(document).on('click', '#openClientPackage', function () {
                console.log("tas do clicavel do OPEN ClientPackages");
                tableReturnable.rows().deselect();
                var myModal = new bootstrap.Modal(document.getElementById('partNumbersExpendable') );
                var va = document.getElementById("supplyPackage.part_number");
                console.log(va);
                myModal.show();
            });

            $('#partNumbersExpendable').on('shown.bs.modal', function (e) {
                console.log("ASD");
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });


/* Clicavél da cell ClientPackage */
$(document).on('click', '#clientPackage', function () {
    console.log("returnable")
    var data = table.row($(this).parents('tr')).data();

    var idPacote = data[10]
    $.ajax({
        type: 'GET',
        url: '/packing/getPNExpendable',
        data: {
            idPacote: idPacote,
        },
        success: function (response) {
            console.log(response)
            var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersExpendable'))
            myModal.show()
            console.log("chegou aqui")
            if (response["listaExpendable"] != null) {
                console.log("entrou no if")
                var myArray = response["listaExpendable"]
                var myFinalString = ""
                for (var key in myArray) {
                    for (var k in myArray[key]) {
                        myFinalString += "<strong>" + k + "</strong>" + ": " + myArray[key][k]
                        myFinalString += "</br>"
                    }
                    myFinalString += "\n<br></br>"
                }
                $('#listPartNumbersExpendable').html(myFinalString);
            } else {
                $('#listPartNumbersExpendable').html(null);
            }
        }
    })
    });


    /* Aqui trata do clicavél do (novo Item) o StockPackage */
$(document).on('click', '#openBomb', function () {
                tableExpendable.rows().deselect();
                var myModal = new bootstrap.Modal(document.getElementById('partNumbersReturnable'))
                var va = document.getElementById("clientPackage.pn");
                console.log("VALUE --> ",va);
                myModal.show()
            });

            $('#partNumbersReturnable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });


    /* Clicavél da cell Bomb */
        $(document).on('click', '#bomb', function () {
            console.log("bomb")
            var data = table.row($(this).parents('tr')).data();
            
            //arranjar maneira de passar o id sem ter de o ir buscar a tabela
            var idPacote = data[10]
            console.log("DATA--> ",data)
            $.ajax({
                type: 'GET',
                url: '/packing/getPNReturnable',
                data: {
                    idPacote: idPacote,
                },


                success: function (response) {
                    console.log(response)
                    var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersReturnable'))
                    myModal.show()
                    if (response["listaReturnable"] != null) {
                        console.log("entrou no if")
                        var myArray = response["listaReturnable"]
                        var myFinalString = ""
                        console.log("ARRAY-> ", myArray)
                        for (var key in myArray) {
                              for (var k in myArray[key]) {
                                myFinalString += "<strong>" + k + "</strong>" + ": " + myArray[key][k]
                                myFinalString += "</br>"
                             }
                            myFinalString += "\n<br></br>"
                            console.log("STRING -->", myFinalString)
                        }
                        
                        $('#listPartNumbersReturnable').html(myFinalString);
                    } else {
                        $('#listPartNumbersReturnable').html(null);
                    }
                }
            })
    });


$('#example').on('change', 'input', function () {
    //Get the cell of the input
    var cella = $(this).closest('th');
    
    //update the input value
    $(this).attr('value', $(this).val());
    var nome = $(this).attr('name')
    var qty = $(this).attr('value')

    //invalidate the DT cache
    table.cell($(cella)).invalidate().draw();

});
    var table = $('#example').DataTable({
        "paging": false,
        orderCellsTop: true,
        fixedHeader: true,
        "scrollY": 400,
        "info": false,
        columnDefs: [{
                    targets: "_all",
                    render: function (data, type, row) {
                        if (data.startsWith('<')) {
                            return data
                        }
                        return data.length > 19 ?
                            data.substr(0, 19) + '…' : 
                            data;
                    }
                }],
        
        
        select: {
            style: 'os',
            selector: 'th:first-child',
            blurable: true
        },
        
        order: [[0, 'asc']],
        initComplete: function () {
            this.api().columns([0, 1]).every(function () {
                $(document).ready(function() {
                    $("td").hover(
                        function() {
                        $(this).css('color', '#000000');
                        }, 
                        function() {
                        $(this).css('background-color', 'none');
                        $(this).css('color', 'black'); // or whatever your original color was
                        }
                    );
});
                        var column = this;
                        
                        var select = $('<select class="form-control" style="margin-left: -18px" id="selected"><option value=""></option></select>')
  
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );
                                column
                                    .search(val ? '^' + val + '$' : '', true, false)
                                    .draw();
                            });

                        column.data().unique().sort().each(function (d, j) {
                            
                            select.append('<option value="' + d + '">' + d + '</option>')
                             console.log("tas",column.data().unique().sort());
                             console.log("Coluna ->", column);

                        });
                    });
                },
            });
           
            // Filter event handler
            $(table.table().container()).on('keyup', 'thead input', function () {
                table
                    .column($(this).data('index'))
                    .search(this.value)
                    .draw();
            });

            
            $('#example tbody').on('click', 'button', function () {
                var data = table.row($(this).parents('tr')).data();
                console.log("CLICASTE EM ALgo", data)
                //alert(data[0] + "'s quantity of " + data[2] + " is: " + data[4]);
                //$("#myModal").modal('show');
                // Add response in Modal body
                //console.log("DATA-> ",data);
                var partNumber = data[0]
                var descricao = data[1]
                var comentario = data[2]
                var client_package = data[3]
                var bomb_item = data[4]
                var suply_time = data[5]
                var stock = data[6]
                var inventario = $(data[7]).val()
                var link = data[8]
                var link_value  = link;
                if (link == "") {
                    link_value = "<strong>None</strong>"
                }
                
            /*     var quantidade = data[4]
                var inventario = $(data[5]).val()
                var tipo = data[6]
                */
                //CHEKS1
                var time = moment().format('DD-MM-YYYY HH:mm:ss');
                $('#partNumber').val(partNumber);
                $('#descricao').html(descricao);
                $('#link').val(link);
                $('#comentario').val(comentario);
                // $('#quantidade').val(quantidade); //BUG
                $('#inventario').val(inventario);
                // $('#quantidadeEdit').val(quantidade);
                $('#inventarioEdit').val(inventario);
                // $('#tipo').val(tipo);
            });

            $('#example tbody').on('click', '#botaoDelete', function () {
                var data = table.row($(this).parents('tr')).data();
                var partNumber = data[0]
                var descricao = data[1]
                var comentario = data[2]
                var client_package = data[3]
                var stock_package = data[4]
                var suply_time = data[5]
                var stock = data[6]
                var inventario = $(data[7]).val()
                var link = data[8]
                console.log(data)

                var modalInfo = "<p>" + "<b>Part-number:</b>&emsp;&emsp;" + data[0] + "</b>" +
                    "<p>" + "<b>Descrição:</b>&emsp;&emsp;&emsp;" + descricao + "</p>" + 
                    "<p>" + "<b>Comentario:</b>&emsp;&emsp;" + comentario + "</p>" +
                    /* "<p>" + "<b>Client Package:</b>&emsp;&emsp;" + client_package + "</p>" +
                    "<p>" + "<b>Parts:</b>&emsp;&emsp;" + stock_package + "</p>" + */
                    "<p>" + "<b>Suply Time:</b>&emsp;&emsp;" + suply_time + "</p>" +
                    "<p>" + "<b>Stock:</b>&emsp;&emsp;&emsp;" + stock + "</p>" +
                    "<p>" + "<b>Inventario:</b>&emsp;" + inventario + "</p>" +
                    "<p>" + "<b>Link:</b>&emsp;&emsp;&emsp;" + link + "</p>"
               
                $("#rowIdDelete").val(data[10])
                $('#infoDelete').html(modalInfo);
            });

            $('#example tbody').on('click', '#botaoEdit', function () {
                console.log("TAS NO EDIT")
                var data = table.row($(this).parents('tr')).data();
                console.log("DATA", data)
                var partNumber = data[0]
                var descricao = data[1]
                var comentario = data[2]
                var client_package = $(data[3]).val()
                var stock_package = $(data[4]).val()
                var suply_time = data[5]
                var inventario = $(data[7]).val()
                var link = data[8]
                var rowIdUpdate = data[10]
                if(!partNumber.length){
                    alert("Introduza um Part-Number válido")
                    return true;
                }
                
                if(inventario < 0){
                    alert("Introduza Inventario válido")
                    return true;
                }
                document.getElementById("novoPartNumberEdit").value = partNumber
                document.getElementById("novoDescriptionEdit").value = descricao
                document.getElementById("novoCommentEdit").value = comentario
                document.getElementById("novoStockProdutoEdit").value = inventario 
                document.getElementById("novoSupplyTimeEdit").value = suply_time
                document.getElementById("partNumbersReturnable").value = client_package 
                document.getElementById("partNumbersExpendable").value = stock_package 

                
                tableReturnable.rows().deselect()
                tableExpendable.rows().deselect()

                $("#rowIdUpdate").val(data[10])
                $.ajax({
                    type: 'GET',
                    url: "{% url 'pManagement:getPNReturnable' %}",
                    data: {
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                        idPacote: rowIdUpdate,
                    },
                    success: function (response) {
                        $.each(tableReturnable.rows().nodes(), function (i, item) {
                            var row = tableReturnable.row(i)

                            for (var x = 0; x < response["listaReturnable"].length; x++) {
                                var val = response["listaReturnable"][x]
                                if (val["id"] == row.data()[3]) {
                                    row.select()
                                    break
                                }
                            }
                        });
                    },
                })

                $.ajax({
                    type: 'GET',
                    url: "{% url 'pManagement:getPNExpendable' %}",
                    data: {
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                        idPacote: rowIdUpdate,
                    },
                    success: function (response) {
                        $.each(tableExpendable.rows().nodes(), function (i, item) {
                            var row = tableExpendable.row(i)
                    //FALTA VERIFICAR SE CONSEGUES RETORNAR OS VALORES QUE ETÂO GUARDADOS NA TABLE
                            for (var x = 0; x < response["listaExpendable"].length; x++) {
                                var val = response["listaExpendable"][x]
                                console.log("coisa a selecionar",val, row.data())
                                if (val["id"] == row.data()[5]) {
                                    console.log("Vai selecionar")
                                    row.select()
                                    break
                                }
                            }console.log("concluio")
                        });
                    },
                })
            });
        });

      /*   function firstClick() {
            window.location.replace("{% url 'pManagement:stockPackage' %}?page=1")
        }

        function prevClick() {
            var page = parseInt("{{ current_page }}")
            
            if ( page == 1)
                alert("Min page reached (" + 1 + ")")
            else
                window.location.replace("{% url 'pManagement:stockPackage' %}?page=" + (page-1))
        }

            
      

        function nextClick() {
            var page = parseInt("{{ current_page }}")
            var page_max = parseInt("{{ page_max }}")
            if (page == page_max)
                alert("Max page reached (" + page_max + ")")
            else
                window.location.replace("{% url 'pManagement:stockPackage' %}?page=" + (page+1))
        }

        function lastClick() {
            var page_max = parseInt("{{ page_max }}")
            window.location.replace("{% url 'pManagement:stockPackage' %}?page=" + (page_max))
        }
        */

        function botaoUpdateStock() {
            const DefaultMixinCss = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-primary',
                    cancelButton: 'btn btn-danger'
                },
                buttonsStyling: false})
            var inventorys = []
            var ids = []

            var table = document.getElementById('example');
            
            for (var i = 1, n = table.rows.length - 1; i < n; i++){
                var row = $(table.rows[i].cells[7].innerHTML)
               
                inventorys.push(row.val())
                if(row.val() <0){
                    DefaultMixinCss.fire({
                title: 'All Stocks must be valid numbers',
                showCancelButton: false,
                confirmButtonText: 'Yes',
                })
                     return false


            }
                ids.push(row.attr("id"))  
            }

            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:updateAllStockSupplyPackage' %}",
                data: {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    ids: ids,
                    inventorys: inventorys,
                },
                success: function () {
                    console.log("[API] Callback to the endpoint sucess")
                },
                complete: function () {
                    //window.location.replace("{% url 'pManagement:supplyPackage' %}")
                   // window.location.reload()
                }
            })
        }




        function botaoUpdateInventario() {
            // FAZEr verificação antes do ouytro popup, caso haja negativos ele nem mostra o outro..
            const DefaultMixinCss = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-primary',
                    cancelButton: 'btn btn-danger'
                },
                buttonsStyling: false
            })
             DefaultMixinCss.fire({
                title: 'Are you sure you want to continue to Update?',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                cancelButtonText: `No`,
                }).then((result) => {
                if (result.isConfirmed) {
                    var inventorys = []
            var ids = []
            var quantidades = []
            var table = document.getElementById('example');
            for (var i = 1, n = table.rows.length - 1; i < n; i++){
                quantidades.push(table.rows[i].cells[8].innerHTML)
                var row = $(table.rows[i].cells[7].innerHTML)
                inventorys.push(row.val())
                
                if(row.val() <0){
                    DefaultMixinCss.fire({
                title: 'All Stocks must be valid numbers',
                showCancelButton: false,
                confirmButtonText: 'Yes',
                })
                     return false
                }
            ids.push(row.attr("id"))  
            }
            console.log("Making the request at updateInventory")
            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:updateInventorySupplyPackage' %}",
                data: {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    ids: ids,
                    inventorys: inventorys,
                    quantidades: quantidades,
                },
                success: function () {
                    console.log("[API] Callback to the endpoint sucess")
                },
                complete: function () {
                    window.location.reload()
                }
            }) 
                }
            })
        }
      

        function ClearFilters() {
            $('.form-control').val('');  // Clear ext and select inputs with classname form-control
            $('#chk').prop('checked', false).change();  // Clear checkbox and trigger change event

            var table = $('#example').DataTable();
            table
                .search('')
                .columns().search('')
                .draw();
        }

        function uploadStockPackage() {
            const DefaultMixinCss = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-primary',
                    cancelButton: 'btn btn-danger'
                },
                buttonsStyling: false
            })
            console.log("Button upload")
            var data = new FormData()
            var file = $("#myfile")[0].files[0]
            if(file==undefined){
               return DefaultMixinCss.fire({
                title: 'No file to upload',
                showCancelButton: false,
                confirmButtonText: 'OK',
                
                })

            }
            data.append("myfile", file)
            data.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val())


            console.log("Seding API REQ")
            $.ajax({
                type: 'POST',
                url: "{% url 'pManagement:uploadStockFile' %}",
                processData : false,
                contentType : false,
                data: data,
                success: function () {
                    console.log("[API] Callback to the endpoint sucess")
                },
               
                complete: function () {
                    window.location.reload()
                }
            })
        }

            $(document).on('click', '#excel', function () {
                window.location.replace("{% url 'pManagement:downloadExcelSupplyPackage' %}")
            });

            $('#partNumbersExpendable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });

            $('#partNumbersReturnable').on('shown.bs.modal', function (e) {
                $.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
            });

            $('#configs tbody').on('click', '#expendable', function () {
                var data = table.row($(this).parents('tr')).data();
                console.log("DATA"+" "+data)

                var idPacote = data[9]

                $.ajax({
                    type: 'GET',
                    url: '/packing/getPNExpendable',
                    data: {
                        idPacote: idPacote,
                    },
                    success: function (response) {
                        var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersExpendable'))
                        myModal.show()
                        if (response["listaExpendable"] != null) {
                            var myArray = response["listaExpendable"]
                            var myFinalString = ""
                            for (let word in myArray) {
                                myFinalString += myArray[word]
                                myFinalString += "</br>"
                            }
                            console.log("myFinalString",myFinalString)
                            $('#listPartNumbersExpendable').html(myFinalString);
                        }
                        else{
                            $('#listPartNumbersExpendable').html(null);
                        }
                    }
                })
            });

            $('#configs tbody').on('click', '#returnable', function () {
                var data = table.row($(this).parents('tr')).data();
                console.log("returnable"+data)

                var idPacote = data[9]

                $.ajax({
                    type: 'GET',
                    url: '/packing/getPNReturnable',
                    data: {
                        idPacote: idPacote,
                    },
                    success: function (response) {
                        console.log(response)
                        var myModal = new bootstrap.Modal(document.getElementById('showPartNumbersReturnable'))
                        myModal.show()
                        if (response["listaReturnable"] != null) {
                            console.log("entrou no if")
                            var myArray = response["listaReturnable"].split(",")
                            var myFinalString = ""
                            for (let word in myArray) {
                                myFinalString += myArray[word]
                                myFinalString += "</br>"
                            }
                            $('#listPartNumbersReturnable').html(myFinalString);
                        } else {
                            $('#listPartNumbersReturnable').html(null);
                        }
                    }
                })
            });

    
            $(document).on('click', '#savePNReturnable', function () {
                var todosReturnable = []
                let todosReturnableFinal = ""
                $.each(tableReturnable.rows('.selected').nodes(), function (i, item) {
                    var data = tableReturnable.row(this).data();
                    console.log(data[1])
                    todosReturnable.push(data[1])
                });
                //alert("Part numbers:  " + todosExpendable);

                for (let member in todosReturnable) {
                    todosReturnableFinal += todosReturnable[member]
                    todosReturnableFinal += ","
                }

                var pacote = document.getElementById('idPacote').value
                var oemEdit = document.getElementById('oemEdit').value
                var produtoEdit = document.getElementById('produtoEdit').value
                var embalagemEdit = document.getElementById('embalagemEdit').value
                var supplyTimeEdit = document.getElementById('supplyTimeEdit').value

                $.ajax({
                    type: 'POST',
                    url: '/packing/savePNReturnable',
                    data: {
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                        idReturnable: pacote,
                        listaPNReturnable: todosReturnableFinal
                    },
                    success: function () {
                        $("#partNumbersReturnable").hide();
                        $("#updateLinha").hide();
                        $(".modal-backdrop").remove();

                        $.ajax({
                            type: 'GET',
                            url: '/packing/getPNReturnable',
                            data: {
                                idPacote: pacote,
                            },
                            success: function (response) {
                                global_listaReturnable = response["listaReturnable"]
                                console.log("success")
                                $.ajax({
                                    type: 'GET',
                                    url: '/packing/getPNExpendable',
                                    data: {
                                        idPacote: pacote,
                                    },
                                    success: function (response) {
                                        global_listaExpendable = response["listaExpendable"]
                                        console.log("success")
                                        var myModal = new bootstrap.Modal(document.getElementById('updateLinha'))
                                        myModal.show()

                                        var modalInfo = "<p>" + "Client:&emsp;&emsp;" + oemEdit + "</p>" +
                                            "<p>" + "Product: &emsp;" + produtoEdit + "</p>" +
                                            "<p>" + "Package:&emsp;" + embalagemEdit + "</p>" +
                                            "<p>" + "Supply time:&emsp;<b>" + supplyTimeEdit + "</b></p>" +
                                            "<p>" + "Part number Returnable:&emsp;" + global_listaReturnable + "</p>" +
                                            "<p>" + "Part number Expendable:&emsp;" + global_listaExpendable + "</p>"

                                        $('#infoEdit').html(modalInfo);
                                        $('#oemEdit').val(oemEdit);
                                        $('#produtoEdit').val(produtoEdit);
                                        $('#embalagemEdit').val(embalagemEdit);
                                        $('#supplyTimeEdit').val(supplyTimeEdit);
                                    }
                                })
                            }
                        })
                    }
                })
            });

            $(document).on('click', '#excel', function () {
                $.ajax({
                    type: 'GET',
                    url: '/pManagement/downloadExcelSupplyPackage/',
                    data: {},
                    success: function () {
                        var element = document.createElement('a');
                        element.setAttribute('href', '/media/workbookSupplyPackage.xls');
                        element.setAttribute('download', 'my-file-name');

                        element.style.display = 'none';
                        document.body.appendChild(element);

                        element.click();

                        document.body.removeChild(element);
                    }
                })
            });

 

            
    </script>
{% endblock %}