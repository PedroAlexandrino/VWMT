{% extends "vware/baseArmazem.html" %}
{% load static %}
{% load utils %}

{% block body_title %}
<style>

  .button {

      height: 70px;

      font-family: Arial, "Helvetica", sans-serif;
      font-size: 45px;
      color: #fff;
      text-decoration: none;
      text-align: center;
      text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
      padding-top: 6px;
      margin-left: auto;
      margin-right: auto;
      left: 30px;
      position: relative;
      cursor: pointer;
      border: none;
      background: #FBA51A;
      background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
      border-radius: 5px;
      box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;

  }

  .tr-hover
  {
      background-color:#fefefe;
  }


  .buttons{
      padding: 15px 25px;
      background: #FBA51A;
      text-align: center;
      padding-top: 6px;
      font-size: 15px;
      width: 100px;
      margin-left: 8px"
  }


  .buttonsUpdate1{
      position: relative;
      right:    0;
      bottom:   35px;
      padding: 5px 10px;
      background: #FBA51A;
      text-align: center;
      font-size: 15px;
      margin: 0;
      width: 5%;
      height: auto;
      margin-left: 81%;

  }
  .buttonsUpdate2{
      position: relative;
      right:    0;
      bottom:   70px;
      padding: 5px 10px;
      background: #FBA51A;
      text-align: center;
      font-size: 15px;
      margin: 0;
      width: 5%;
      height: auto;
      margin-left: 81%;
  }
  .buttonsPaginator{
      position: relative;
      padding: 5px 10px;
      background: #FBA51A;
      text-align: center;

  }
  .buttonFirst{
      position: relative;
      right:    0;
      background: #FBA51A;
      text-align: center;
      margin: 0;
      height: auto;

      padding: 2px 5px;
      font-size: 15px;
      width: 4%;
      margin-left: 80%;
      bottom:   121px;


  }
  .buttonPrevious{
      position: relative;
      right:    0;
      background: #FBA51A;
      text-align: center;
      margin: 0;
      height: auto;

      padding: 2px 5px;
      font-size: 15px;
      width: 4%;
      margin-left: 84%;
      bottom:   145px;
  }
  .buttonActual{
      position: relative;
      right:    0;
      background: #FBA51A;
      text-align: center;
      margin: 0;
      height: auto;

      padding: 2px 5px;
      font-size: 15px;
      width: 2%;
      margin-left: 88%;
      bottom:   169px;
  }
  .buttonNext{
      position: relative;
      right:    0;
      background: #FBA51A;
      text-align: center;
      margin: 0;
      height: auto;

      padding: 2px 5px;
      font-size: 15px;
      width: 3%;
      margin-left: 90%;
      bottom:   193px;
  }
  .buttonLast{
      position: relative;
      right:    0;
      background: #FBA51A;
      text-align: center;
      margin: 0;
      height: auto;

      padding: 2px 5px;
      font-size: 15px;
      width: 3%;
      margin-left: 93%;
      bottom:   217px;
  }
</style>
<div class="text-primary" xmlns="http://www.w3.org/1999/html">
  <h6>
    <b
      ><i class="fa fa-home text-secondary"></i><a href={% url 'main:main' %}><span class="text-secondary"> 
        Home | </span></a> Cliente Package</b>
  </h6>
</div>
{% endblock %}
{% block body_content %}
<!-- MAIN -->
<div class="containerPath mt-4" style="margin-left: 30px">
  <div class="path" id="uploadClass" <div class="mt-3">
    {% if erro %}
    <br />
    <div class="text-center">
      <h1><b>{{ erro }}</b></h1>
    </div>
    <br />
    {% endif %}
    <table id="example" class="stripe hover cell-border" style="width: 100%">
      <thead>
        <tr>
          <td>Client</td>
          <td>Product Name</td>
          <td>Comment</td>
          <td></td>
          <td style="display: none"></td>
        </tr>
      </thead>
      <tbody>
        <!-- for que vai precorrer todos os dados da view no caso em especifico, vai precorrer a tabela das relações Cliente & Produto -->
        {% for ref in ClienteProduto.all %}
        <tr>
          <td style="width: 40%" title="{{ ref.cliente.oem|default:""}}">{{ref.cliente.oem|default:""}}</td>
          
          <td style="width: 40%" title="{{ ref.produto.nome|default:""}}">{{ref.produto.nome|default:""}}</td>

          <td style="width: 40%" title="{{ ref.comment|default:""}}">{{ref.comment|default:""}}
          <td style="width: 10%">
            <div class="form-inline">
              <a
                type="button"
                id="botaoEdit"
                title="Edit"
                class="fas fa-pen-square"
                style="height: 18px; margin-left: 10px"
                data-toggle="modal"
                data-target="#updateLinha"
              >
              </a>
              <a
                type="button"
                id="botaoDelete"
                title="Delete"
                class="fas fa-trash-alt"
                style="margin-left: 10px; height: 18px"
                data-toggle="modal"
                data-target="#deleteLinha"
              >
              </a>
            </div>
          </td>
          <td style="display: none" value="{{ ref.id }}">{{ ref.id }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th>Cliente</th>
          <th>Descrição</th>
          <th>Comentario</th>
          <th></th>
          <th style="display: none"></th>
        </tr>
      </tfoot>
    </table>

    <div
      style="
        width: 30%;
        margin-left: 30%;
        top: 120%;
        position: absolute;
        border: 3px solid transparent;
        text-align: center;
      "
    >
      <button
        type="submit"
        class="button"
        data-toggle="modal"
        data-target="#addLinha"
      >
        NOVO ITEM
      </button>
    </div>
    <div style="position: absolute">
      <button
        type="button"
        class="form-control"
        style="background-color: lightgrey"
        id="excel"
      >
        Excel
      </button>
    </div>

    <!-- 
                        <button type="button"  title="Download Excel" class="btn btn-primary buttons"  onclick="uploadStockPackage()" style="background-color: #21127251" id="excel">Excel</button>
                  -->
    <!-- Modal onde é adicionada uma nova linha -->
    {% csrf_token %}
    <div
      class="modal fade"
      id="addLinha"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <!-- modal onde vai ser adicionado nova relação -->
            <h3 class="modal-title" id="myModalLabel"><b>Create new row</b></h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <table class="table table-borderless mb-n1">
              <thead></thead>
              <tbody>
                <div class="form-inline">
                  <p class="mt-2">Cliente</p>
                  <input list="clientList" id="getCliente" name="getCliente" />
                  <datalist id="clientList">
                    {% for clientes in ClientesOEM.all %}
                    <option value="{{clientes.oem}}" ></option>
                    {% endfor %}
                  </datalist>
                  

                   
                </div>
                <div class="form-inline mt-3">
                  <h6 class="mt-1" >Product:</h6>
                  <input list="prodList" id="getProds" name="getProds"  />
                  <datalist id="prodList">
                    {% for produtos in Produtos.all %}
                    <option value="{{produtos.nome}}"></option>
                    {% endfor %}
                  </datalist>
                </div>
                {% if erro %}
                <div class="text-center mb-n2">
                  <b>{{ erro }}</b>
                </div>
                {% endif %}

                <tr></tr>

                <tr>
                  <th scope="row" style="color: black">
                    <h6><b>Comment</b></h6>
                  </th>
                  <td>
                    <input type="text" name="newComment" id="newComment" />
                  </td>
                </tr>
              </tbody>
            </table>
            {% if erro2 %}
            <div class="text-center">
              <b>{{ erro2 }}</b>
            </div>
            {% endif %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              id="CreateNewRowBotton"
            >
              Create
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal onde é feito o delete de uma linha especifica -->
    <form
      method="POST"
      class="form"
      action="{% url 'pManagement:deleteLinhaClienteProduto' %}"
      enctype="multipart/form-data"
    >
      {% csrf_token %}
      <div
        class="modal fade"
        id="deleteLinha"
        tabindex="-1"
        role="dialog"
        aria-labelledby="myModalLabel">

        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title" id="myModalLabel">
                <b>Delete this row?</b>
              </h3>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p id="infoDelete"></p>
              <input
                type="hidden"
                id="rowIdDelete"
                name="rowIdDelete"
                value="{{rowIdDelete}}"
              />
              <!-- garantir que o id que vai é relativo ao id do supplyPackage que depois vai estar contido na tabela -->
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Delete</button>
            </div>
          </div>
        </div>
      </div>
    </form>
    <!-- Modal onde é feito EDIT de cada linha -->

    <div
      class="modal fade"
      id="updateLinha"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="myModalLabel"><b>Edit Row</b></h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input
              type="hidden"
              id="rowIdUpdate"
              name="rowIdUpdate"
              value="{{ rowIdUpdate }}"/>

            <h3><b>Replace by: </b></h3>
            <div class="form-inline">
               
              <input list="clientList" id="getClienteEdit" name="getClienteEdit" list="clientList" />

              <datalist id="clientList">
                {% for clientes in ClientesOEM.all %}
                <option value="{{clientes.oem}}"></option>
                {% endfor %}
              </datalist>
             

            </div>
            <div class="form-inline mt-3">
              <input list="prodList" id="getProdsEdit" name="getProdsEdit" list="prodList" />
              <datalist id="prodList">
                {% for produtos in Produtos.all %}
                <option value="{{produtos.nome}}"></option>
                {% endfor %}
              </datalist>
            </div>
            {% if erro %}
            <div class="text-center mb-n2">
              <b>{{ erro }}</b>
            </div>
            {% endif %}

            <tr></tr>

            <tr>
              <th scope="row" style="color: black">
                <h6><b>Comment</b></h6>
              </th>
              <td><input type="text" name="editComment" id="editComment" /></td>
            </tr>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn btn-primary" id="EditRowButton">
              Save
            </button>
          </div>
        </div>
      </div>

      <!-- MODAL DOS CLICAVEIS DO ADD/EDIT-->
      <div
        class="modal fade"
        id="partNumbersExpendable"
        data-backdrop="false"
        tabindex="-1"
        role="dialog"
        aria-labelledby="myModalLabel"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title" id="myModalLabel">
                <b>Cliente Package:</b>
              </h3>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p id="infoLinhaExpendable"></p>
              <table id="pnExpendableTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <td></td>
                    <th>Client name</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {% for pn in clientes.all %}
                  <tr>
                    <td></td>
                    <td>{{ pn.oem }}</td>
                    <td></td>
                  </tr>
                  {% endfor %}
                </tbody>
                <tfoot>
                  <tr>
                    <td></td>
                    <th></th>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
            <button type="submit" id="savePNExpendable" class="btn btn-primary">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DOS CLICAVEIS DIRETAMENTE DA TABELA -->
    <div
      class="modal fade"
      id="partNumbersReturnable"
      data-backdrop="false"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="myModalLabel"><b>Products</b></h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="infoLinhaReturnable"></p>
            <table id="pnReturnable" class="display" style="width: 100%">
              <thead style="width: 100%">
                <tr>
                  <th></th>
                  <th>Products</th>
                  <th style="display: none"></th>
                </tr>
              </thead>
              <tbody>
                {% for pn in Produtos.all %}
                <tr>
                  <td></td>
                  <td>{{ pn.nome }}</td>
                  <td style="display: none">{{ pn.id }}</td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td></td>
                  <th style="display: none"></th>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="listaClientProd"
      data-backdrop="false"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myModalLabel"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="myModalLabel"><b>ProductsV11</b></h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <table
              id="listaLinhaReturnable"
              class="display"
              style="width: 100%"
            >
              <thead style="width: 100%">
                <tr>
                  <th>Products</th>
                  <th style="display: none"></th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td style="display: none"></td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    {% endblock %} {% block javascript %}
    <script>





      $(".clearable.example .ui.selection.dropdown").dropdown({
        clearable: true,
      });
      $(".clearable.example .ui.inline.dropdown").dropdown({
        clearable: true,
        placeholder: "any",
      });

      $(document).ready(function () {
        // Setup - add a text input to each footer cell
        $("#example thead th").each(function (i) {
          var title = $("#example thead th").eq($(this).index()).text();
          $(this).html(
            '<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' +
              title +
              '" data-index="' +
              i +
              '" />'
          );
        });

        $("#example").on("change", "input", function () {
          //Get the cell of the input
          var cella = $(this).closest("th");

          //update the input value
          $(this).attr("value", $(this).val());
          var nome = $(this).attr("name");
          var qty = $(this).attr("value");

          //invalidate the DT cache
          table.cell($(cella)).invalidate().draw();
        });

        var table = $("#example").DataTable({
          paging: false,
          orderCellsTop: true,
          fixedHeader: true,
          height: 1,
          overflowY : "scroll",
          info: false,
        
          select: {
            style: "os",
            selector: "th:first-child",
            blurable: true,
          },

          order: [[0, "asc"]],

          initComplete: function () {
            this.api()
              .columns([0, 1])
              .every(function () {
                $(document).ready(function () {
                  $("td").hover(
                    function () {
                      // $(this).get((this.selectedRow));
                      $(this).css("color", "#000000");
                    },
                    function () {
                      $(this).css("background-color", "none");
                      $(this).css("color", "black"); // or whatever your original color was
                    }
                  );
                });
                var column = this;

                var select = $(
                  '<select class="form-control" style="margin-left: -18px" id="selected"><option value=""></option></select>'
                )
                  .appendTo($(column.footer()).empty())
                  .on("change", function () {
                    var val = $.fn.dataTable.util.escapeRegex($(this).val());
                    column
                      .search(val ? "^" + val + "$" : "", true, false)
                      .draw();
                  });

                column
                  .data()
                  .unique()
                  .sort()
                  .each(function (d, j) {
                    select.append(
                      '<option value="' + d + '">' + d + "</option>"
                    );
                    console.log("tas", column.data().unique().sort());
                    console.log("Coluna ->", column);
                  });
              });
          },
        });

        $("#example tbody").on("click", "#botaoDelete", function () {
          var data = table.row($(this).parents("tr")).data();
          console.log("CHEGOU AO DELETwdwdaE");

          console.log("DATA-> ", data);
          var cliente = data[0];
          var comment = data[2];
          var produto = data[1];

          var modalInfo =
            "<p>" +
            "<b>Client Name:</b>&emsp;&emsp;" +
            data[0] +
            "</b>" +
            "<p>" +
            "<b>Comment:</b>&emsp;&emsp;&emsp;" +
            comment +
            "</p>" +
            "<p>" +
            "<b>Produto:</b>&emsp;&emsp;&emsp;" +
            produto 
            "</b>" +
            "<p>" 

          $("#rowIdDelete").val(data[4]);
          $("#infoDelete").html(modalInfo);
        });

        // Filter event handler
        $(table.table().container()).on("keyup", "thead input", function () {
          table.column($(this).data("index")).search(this.value).draw();
        });

        $("#listaClientProd").on("hidden.bs.modal", function () {
          $(this).find("form").trigger("reset");
        });

        $("#example tbody").on("click", "button", function () {
          var data = table.row($(this).parents("tr")).data();
          //alert(data[0] + "'s quantity of " + data[2] + " is: " + data[4]);
          //$("#myModal").modal('show');
          // Add response in Modal body
          console.log("CLICAS_TE EM ALGO")
          var cliente = data[0];
          var comment = data[2];
          var produto = data[1];

          // falta linkar seguintes campos com os ids dos campos da tabela exemple (a)
          var time = moment().format("DD-MM-YYYY HH:mm:ss");
          $("#cliente_name").val(cliente);
          $("#comentario").val(comment);
          $("#prod_name").val(produto);
        });

        $(document).on("click", "#botaoEdit", function () {
          var data = table.row($(this).parents("tr")).data();
          var cliente = data[0];
          var commentario = data[2];

          console.log("cliente", cliente);
          console.log("commentario", commentario);
          $('#clienteEdit option[data-name="' + cliente + '"]')
            .show()
            .prop("selected", true);
          document.getElementById("editComment").value = commentario;
          document.getElementById("rowIdUpdate").value = data[4];

          tableReturnable.rows().deselect();
          $.each(tableReturnable.rows().nodes(), function (i, item) {
            var row = tableReturnable.row(i);

            rows.some((element) => {
              if (element["cliente_id"] == data[4]) {
                row.select();
                return true;
              }
              return false;
            });
          });
        });

        function ClearFilters() {
          $(".form-control").val(""); // Clear ext and select inputs with classname form-control
          $("#chk").prop("checked", false).change(); // Clear checkbox and trigger change event

          var table = $("#example").DataTable();
          table.search("").columns().search("").draw();
        }

        $(document).on("click", "#excel", function () {
          console.log("PRINT");
         // window.location.replace(
            //"{% url 'pManagement:downloadExcelClienteProduto' %}"
          //);
        });

        /* --------------------/////--------------------------------BTNS COM POPUPS-----------------//------ */

        var tableExpendable = $("#pnExpendableTable").DataTable({
          info: false,
          paging: false,
          scrollCollapse: true,
          scrollY: "420px",
          columnDefs: [
            {
              orderable: false,
              className: "select-checkbox",
              targets: 0,
            },
          ],
          select: {
            style: "multi",
            selector: "td:first-child",
          },
          order: [[1, "asc"]],

          initComplete: function () {
            this.api()
              .columns([1])
              .every(function () {
                var that = this;
                //$('#pnExpendable tfoot tr').appendTo('#pnExpendable thead');   // To displays the search boxs at the top instead to the bottom of the table
                $("input", this.footer()).on("keyup change clear", function () {
                  console.log("print10");
                  if (that.search() !== this.value) {
                    that.search(this.value).draw();
                  }
                });
              });
          },
        });

        $("#pnReturnable tfoot th").each(function (i) {
          var title = $("#pnReturnable tfoot th").eq($(this).index()).text();
          //$(this).html('<input class="form-control" style="margin-left: -18px" type="text" placeholder="Search ' + title + '" data-index="' + i + '" />');
        });
        var tableReturnable = $("#pnReturnable").DataTable({
          info: false,
          paging: false,
          scrollCollapse: true,
          scrollY: "420px",
          columnDefs: [
            {
              orderable: false,
              className: "select-checkbox",
              targets: 0,
            },
          ],
          select: {
            style: "multi",
            selector: "td:first-child",
          },
          order: [[1, "asc"]],
          initComplete: function () {
            this.api()
              .columns([1])
              .every(function () {
                var that = this;

                //$('#pnReturnable tfoot tr').appendTo('#pnReturnable thead');   // To displays the search boxs at the top instead to the bottom of the table
                $("input", this.footer()).on("keyup change clear", function () {
                  console.log("print6");
                  if (that.search() !== this.value) {
                    that.search(this.value).draw();
                  }
                });
              });
          },
        });

        /* Clicavel da cell ClientPackage */
        /* Verificar os nomes para conseguires enviar para a view o ID do item selecionado */
        $(document).on("click", "#CreateNewRowBotton", function () {
          var newComment = $("#newComment").val();

          var clienteAdd = $("#getCliente").val();
          var produtos =  $("#getProds").val();
         // var newClient = clienteAdd.querySelector('[value='${"#clientList"}) 

          //console.log("campos-> ",prods,el,clienteAdd, produtos, newComment)
          console.log("CLIENTES", clienteAdd)
          if(clienteAdd == "" || produtos == ""){
            alert("Preencha os campos obrigatorios")
            console.log("campos-> ", produtos, newComment)
            return
          }


          $.ajax({
            type: "POST",
            url: "{% url 'pManagement:createClienteProduto' %}",
            data: {
              csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
              newClient : clienteAdd,
              newProd : produtos,
              newComment: newComment,
            },
            complete: function () {
              //window.location.replace("{% url 'pManagement:clienteProduto' %}");
            },
          });
        });

        $(document).on("click", "#EditRowButton", function () {
          /* $("#example tbody").on("click", "#EditRowButton", function () { */
      

          console.log("Cliscas-te no save");
          var rowIdUpdate = $("#rowIdUpdate").val();
          var cliente = $("#getClienteEdit").val();
          var prods =  $("#getProdsEdit").val();
          var novoCommentEdit = $("#editComment").val();


          console.log("REQUEST A CAMINHO COM.... --> ", novoCommentEdit)
          /* var stockPackages = [];
          getProds
          $.each(tableReturnable.rows(".selected").nodes(), function (i, item) {
            var data = tableReturnable.row(this).data();
            stockPackages.push(data[2]);
          });
 */
          var dataForm = new FormData();
         // var stockPackages = document.getElementById('getProds').value;
          dataForm.append("rowIdUpdate", rowIdUpdate);
          dataForm.append("editComment", novoCommentEdit);
          dataForm.append("getCliente", cliente);
          dataForm.append("getProds", prods);
          dataForm.append(
            "csrfmiddlewaretoken",
            $("input[name=csrfmiddlewaretoken]").val()
          );

          $.ajax({
            type: "POST",
            url: "{% url 'pManagement:updateClienteProduto' %}",
            contentType: false,
            processData: false,
            data: dataForm,
            success: function () {
              console.log("[API] Callback to the endpoint sucess");
            },
            complete: function () {
              setTimeout(function(){
                //window.location.replace("{% url 'pManagement:clienteProduto' %}");

                }, 1300);  
            },
          });
        });

        //----------------------------- para apagar -----------------------------\\
/*
        $(document).on("click", "#savePNReturnable", function () {
          console.log("clicou no antigo returnable");
          var todosReturnable = [];
          let todosReturnableFinal = "";
          $.each(tableReturnable.rows(".selected").nodes(), function (i, item) {
            var data = tableReturnable.row(this).data();
            console.log(data[1]);
            todosReturnable.push(data[1]);
          });
          //alert("Part numbers:  " + todosExpendable);

          for (let member in todosReturnable) {
            todosReturnableFinal += todosReturnable[member];
            todosReturnableFinal += ",";
          }

          var pacote = document.getElementById("idPacote").value;
          var oemEdit = document.getElementById("clienteEdit").value;
          var produtoEdit = document.getElementById("produtoEdit").value;
          var commentEdit = document.getElementById("editComment").value;

           $.ajax({
            type: "POST",
            url: "/packing/savePNReturnable",
            data: {
              csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
              idReturnable: pacote,
              listaPNReturnable: todosReturnableFinal,
            },
            success: function () {
              $("#partNumbersReturnable").hide();
              $("#updateLinha").hide();
              $(".modal-backdrop").remove();

              $.ajax({
                type: "GET",
                url: "/packing/getPNReturnable",
                data: {
                  idPacote: pacote,
                },
                success: function (response) {
                  global_listaReturnable = response["listaReturnable"];
                  console.log("success");
                  $.ajax({
                    type: "GET",
                    url: "/packing/getPNExpendable",
                    data: {
                      idPacote: pacote,
                    },
                    success: function (response) {
                      global_listaExpendable = response["listaExpendable"];
                      console.log("success");
                      var myModal = new bootstrap.Modal(
                        document.getElementById("updateLinha")
                      );
                      myModal.show();

                      var modalInfo =
                        "<p>" +
                        "Client:&emsp;&emsp;" +
                        oemEdit +
                        "</p>" +
                        "<p>" +
                        "Product: &emsp;" +
                        produtoEdit +
                        "</p>" +
                        "<p>" +
                        "Comentario:&emsp;<b>" +
                        commentEdit +
                        "</b></p>" +
                        "<p>" +
                        "Part number Expendable:&emsp;" +
                        global_listaExpendable +
                        "</p>";

                      $("#infoEdit").html(modalInfo);
                      $("#clienteEdit").val(oemEdit);
                      $("#produtoEdit").val(produtoEdit);
                      $("#editComment").val(commentEdit);
                    },
                  });
                },
              });
            },
          });
        });

        var listaLinhaReturnable = $("#listaLinhaReturnable").DataTable({
          autoWidth: true,
          info: false,
          paging: false,
          scrollCollapse: true,
          scrollY: "420px",
          order: [[1, "asc"]],
        });

        var rows = undefined;
        $.ajax({
          type: "GET",
          url: "{% url 'pManagement:returnListaProdutos' %}",
          data: {
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
          },
          success: function (response) {
            console.log("Sucesso!!!");
            rows = response["listaProds"];
          },
        });

        $(document).on("click", "#ShowRelProdutsButton", function () {
          var data = table.row($(this).parents("tr")).data();
          var relId = data[4];
          listaLinhaReturnable.clear();

          rows.forEach((element) => {
            if (relId == element["cliente_id"]) {
              listaLinhaReturnable.row.add([element["nome"], element["id"]]);
            }
          });
          listaLinhaReturnable.draw();
          //este callback serve para mostrar a tabela do btn da cell
          $("#listaClientProd").modal("show");
        });
      });
 */
      $(document).on("click", "#excel", function () {
        $.ajax({
          type: "GET",
          url: "/pManagement/downloadExcelClienteProduto/",
          data: {},
          success: function () {
            var element = document.createElement("a");
            element.setAttribute("href", "/media/workbookSupplyPackage.xls");
            //é aqui que se pode fazer o sistema de pastas?
            element.setAttribute("download", "my-file-name");

            element.style.display = "none";
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
          },
        });
      });
    });
    </script>
    {% endblock %}
  </div>
</div>
 