{% extends "vware/baseArmazemPortaria.html" %}
{% load static %}

{% block body_title %}

    <div class="text-primary">
        <h6><b><i class="fa fa-home text-secondary"></i><a href={% url 'main:main' %}><span
                class="text-secondary"> Home | </span></a> Shippers Tracking</b></h6>
    </div>
    <style>

        .button {
            width: 35%;
            height: 70px;
            display: inline-block;
            font-family: Arial, "Helvetica", sans-serif;
            font-size: 45px;
            color: #fff;
            text-decoration: none;
            text-align: center;
            text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
            padding-top: 6px;
            margin-left: auto;
            margin-right: auto;
            left: 30px;
            position: relative;
            cursor: pointer;
            border: none;
            background: #FBA51A;
            background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
            border-radius: 5px;
            box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;
        }

        .button:active {
            top: 3px;
            box-shadow: inset 0px 1px 0px #FBA51A, 0px 2px 0px 0px #E57200, 0px 5px 3px #999;
        }

        .button:hover, button:focus {
            outline: none;
            transform: translateY(0.5px);
        }

        .containerPrincipal {
            height: 860px;
            width: 100%;
            top: 11px;
            left: 0px;
            position: relative;
            border: 1px solid transparent;
        }

        .column_left {
            border-left: 2px solid black;
        }

        tfoot input {
            width: 100%;
        }

        #btnMostrarSubitens {
            background-color: #4CAF50; /* Cor de fundo do botão */
            border: none;
            color: white; /* Cor do texto do botão */
            padding: 3px 9px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 2px 1px;
            cursor: pointer;
            border-radius: 50%; /* Deixa o botão redondo */
        }

        #btnMostrarSubitens span {
            font-size: 24px;
        font-weight: bold;
        }


        #quadradoSubItems {
  background-color: #4CAF50; /* Cor de fundo do botão */
  border: none;
  padding: 12px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 24px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 8px; /* Define a borda arredondada */
}

#quadradoSubItems span {
  display: block;
  width: 16px;
  height: 16px;
  transform: rotate(45deg); /* Rotaciona o quadrado em 45 graus */
  margin: auto; /* Centraliza o quadrado vertical e horizontalmente */
}

        @media screen and (max-width: 1700px) {
            .button {
                width: 35%;
                height: 70px;
                display: inline-block;
                font-family: Arial, "Helvetica", sans-serif;
                font-size: 45px;
                color: #fff;
                text-decoration: none;
                text-align: center;
                text-shadow: 1px 1px 0 #7D9EAD, 2px 2px 0 #7D9EAD, 1px 1px 0 #7D9EAD;
                padding-top: 6px;
                margin-left: auto;
                margin-right: auto;
                left: 30px;
                position: relative;
                cursor: pointer;
                border: none;
                background: #FBA51A;
                background-image: linear-gradient(bottom, #E57200 0%, #FBA51A 100%);
                border-radius: 5px;
                box-shadow: inset 0px 1px 0px #FBA51A, 0px 5px 0px 0px #cb7b25, 0px 10px 5px #999;
            }

            .button:active {
                top: 3px;
                box-shadow: inset 0px 1px 0px #FBA51A, 0px 2px 0px 0px #E57200, 0px 5px 3px #999;
            }

            .button:hover, button:focus {
                outline: none;
                transform: translateY(0.5px);
            }

            .containerPrincipal {
                height: 790px;
                width: 100%;
                top: 11px;
                left: 0px;
                position: relative;
                border: 1px solid transparent;
            }

            .column_left {
                border-left: 2px solid black;
            }

            tfoot input {
                width: 100%;
            }
        }
    </style>
{% endblock %}

{% block body_content %}
    <div class="containerPrincipal" style="height: 50%">
        
        <table id="qadShipersTable"  class="display" style="margin-left: 0%; height: 150%;  width: 100%; text-align: center">
            <thead>
            <tr>
                <th  style="font-size: 13px">ID</th>
                <th  style="font-size: 13px">Ship Date</th>
                <th  style="font-size: 13px">Ship Time</th>
                <th  style="font-size: 13px">City</th>
                <th  style="font-size: 13px">Country</th>
                <th  style="font-size: 13px">Carrier</th>
                <th  style="font-size: 13px">FOB</th>
                <th  style="font-size: 13px">Mode of Transport</th>
                <th  style="font-size: 13px">Vehicle ID</th>
                <th  style="font-size: 13px">Confirmed</th>
                <th  style="font-size: 13px">Comentarios</th>
                <th  style="font-size: 13px">Timestamp</th>
                <th style="display: none">Status</th>   
                <th style="display: none">Date Validation</th>
                <th style="display: none">ID</th>
            </tr>
            </thead>
            <tbody>
                {% for element in shippers_tracking %}
                {% if element.estado == "outdated" %}
                {% else %}
                {% if element.estado == "deleted" %}
                    <tr>
                        <td title="{{ element.abs_id }}" style="background-color: #fd5d3d;">{{ element.abs_id }}</td>
                        {% if element.date_validation == "False" %}
                            <td title="{{ element.ship_date }}"style="background-color: #fd5d3d;">{{ element.ship_date }}</td>
                        {% else %}
                            <td title="{{ element.ship_date }}"style="background-color: #bdffd0;">{{ element.ship_date }}</td>
                        {% endif %}
                        <td title="{{ element.ship_time }}"style="background-color: #fd5d3d;">{{ element.ship_time }}</td>
                        <td title="{{ element.city }}"style="background-color: #fd5d3d;">{{ element.city }}</td>
                        <td title="{{ element.country }}"style="background-color: #fd5d3d;">{{ element.country }}</td>
                        <td title="{{ element.carrier }}"style="background-color: #fd5d3d;">{{ element.carrier }}</td>
                        <td title="{{ element.fob }}"style="background-color: #fd5d3d;">{{ element.fob }}</td>
                        <td title="{{ element.mode_of_transport }}"style="background-color: #fd5d3d;">{{ element.mode_of_transport }}</td>
                        <td title="{{ element.vehicle_id }}"style="background-color: #fd5d3d;">{{ element.vehicle_id }}</td>
                        <td title="{{ element.confirmed }}"style="background-color: #fd5d3d;">{{ element.confirmed }}</td>
                        <td style="background-color: #fd5d3d;"> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                            data-placement="bottom" title='{{ element.comentarios }}'
                            value='{{ element.comentarios }}'>
                        </td>
                        <td title="{{ element.confirmed }}"style="background-color: #fd5d3d;">{{ element.timestamp }}</td>
                        <th style="display: none" >{{ element.estado }}</th>
                        <th style="display: none">{{ element.date_validation }}</th>
                        <th style="display: none" >{{ element.id }}</th>

                    </tr>
                {% else %}
                {% if element.estado == "updated" %}
                    <tr>
                        <td title="{{ element.abs_id }}" style="background-color: #fdbd55;">{{ element.abs_id }}</td>
                        {% if element.date_validation == "False" %}
                            <td title="{{ element.ship_date }}"style="background-color: #fdbd55;">{{ element.ship_date }}</td>
                        {% else %}
                            <td title="{{ element.ship_date }}"style="background-color: #bdffd0;">{{ element.ship_date }}</td>
                        {% endif %}
                        <td title="{{ element.ship_time }}"style="background-color: #fdbd55;">{{ element.ship_time }}</td>
                        <td title="{{ element.city }}"style="background-color: #fdbd55;">{{ element.city }}</td>
                        <td title="{{ element.country }}"style="background-color: #fdbd55;">{{ element.country }}</td>
                        <td title="{{ element.carrier }}"style="background-color: #fdbd55;">{{ element.carrier }}</td>
                        <td title="{{ element.fob }}"style="background-color: #fdbd55;">{{ element.fob }}</td>
                        <td title="{{ element.mode_of_transport }} "style="background-color: #fdbd55;">{{ element.mode_of_transport }}</td>
                        <td title="{{ element.vehicle_id }}"style="background-color: #fdbd55;">{{ element.vehicle_id }}</td>
                        <td title="{{ element.confirmed }}"style="background-color: #fdbd55;">{{ element.confirmed }}</td>
                        <td style="background-color: #fdbd55;"> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                            data-placement="bottom" title='{{ element.comentarios }}'
                            value='{{ element.comentarios }}'>
                        </td>
                        <td title="{{ element.confirmed }}"style="background-color: #fdbd55;">{{ element.timestamp }}</td>
                        <th style="display: none" >{{ element.estado }}</th>
                        <th style="display: none">{{ element.date_validation }}</th>
                        <th style="display: none" >{{ element.id }}</th>
                        
                    </tr>
                {% else %}
                    <tr>
                        <td title="{{ element.abs_id }}">{{ element.abs_id }}</td>
                        {% if element.date_validation == "False" %}
                        <td title="{{ element.ship_date }}">{{ element.ship_date }}</td>
                        {% else %}
                            <td title="{{ element.ship_date }}"style="background-color: #bdffd0;">{{ element.ship_date }}</td>
                        {% endif %}
                        
                        <td title="{{ element.ship_time }}">{{ element.ship_time }}</td>
                        <td title="{{ element.city }}">{{ element.city }}</td>
                        <td title="{{ element.country }}">{{ element.country }}</td>
                        <td title="{{ element.carrier }}">{{ element.carrier }}</td>
                        <td title="{{ element.fob }}">{{ element.fob }}</td>
                        <td title="{{ element.mode_of_transport }}">{{ element.mode_of_transport }}</td>
                        <td title="{{ element.vehicle_id }}">{{ element.vehicle_id }}</td>
                        <td title="{{ element.confirmed }}">{{ element.confirmed }}</td>
                        <td> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                            data-placement="bottom" title='{{ element.comentarios }}'
                            value='{{ element.comentarios }}'>
                        </td>
                        <td title="{{ element.confirmed }}">{{ element.timestamp }}</td>
                        <th style="display: none" >{{ element.estado }}</th>
                        <th style="display: none">{{ element.date_validation }}</th>
                        <th style="display: none" >{{ element.id }}</th>
                    </tr>
                {% endif %}
                 {% endif %}
                {% endif %}

                {% endfor %}
            </tbody>
            <tfoot>
            <tr>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px"></th>
                <th  style="font-size: 13px;display: none"></th>
                <th style="display: none"></th>
                <th style="display: none"></th>
            </tr>
            </tfoot>
        </table>


             
            <div style="width: 85%; margin-left: 6%; bottom: 0%; position: absolute; border: 3px solid transparent; text-align: center">
                 <!-- Aqui estava o btn de nova Entrada-->
            </div>
            <div style="position: absolute; right: 25px; bottom: 0">
                <a href="#reportIssue" data-toggle="modal" data-target="#reportIssue" class="fas fa-info-circle"
                   style="font-size: 15px; height: 22px"> Help</a>
            </div>
            </div>
       
    <form method="POST" enctype="multipart/form-data" action="{% url 'shippers:reportPortariaTracking' %}">
        {% csrf_token %}
        <div class="modal fade" id="reportIssue" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: rgba(236,144,0,0.86)">
                        <h4 class="modal-title" id="myModalLabel" style="margin-left: 45%; font-size: 40px"><i>HELP</i>
                        </h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body"
                         style="background: linear-gradient(to bottom, rgba(236,144,0,0.86) 0%, ghostwhite 100%); ">
                        <div style="margin-top: 10px">
                            <p style="font-size: 20px"><strong>Escreva aqui possiveis erros de utilzacao desta pagina
                                em especifico, ou deixe sugestoes de melhoria</strong></p>
                            <textarea class="form-control mt-n3" name="reportICDR" id="reportICDR" rows="11"
                                      style="background-color: floralwhite; text-align: center;font-family:sans-serif;font-size:1.5em"
                                      required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer" style="background-color: ghostwhite">
                        <button type="submit" id="submitReportICDR" class="btn btn-primary">Submeter</button>
                        <button type="button" class="btn btn-primary" value="pending" data-dismiss="modal">Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
     



     








{% endblock %}

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/confetti.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.2/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.2/css/jquery.dataTables.min.css">

    <script>
    
        
    

        var data = "{{id_to_refresh}}";
        var dataObj = new Date(data);
        var hora = dataObj.getHours();
        var minutos = dataObj.getMinutes();
        var segundos = dataObj.getSeconds();
        console.log(hora, minutos, segundos);

        var id_to_refresh = hora + ":" + minutos + ":" + segundos;
  document.getElementById("refresh-btn").textContent = "Refresh Automatico (10m) LAST " + id_to_refresh;

    $(document).ready(function () {
       

        var selectedDates1 = [];
        var today = new Date()
    var datePicker = flatpickr("#calendar", {
        inline: true,
        dateFormat: "Y-m-d",
        mode: "range",
        defaultDate: [today, today],
    onClose: function(selectedDates, dateStr, instance) {
         
        selectedDates1 = [selectedDates[0], selectedDates[1]];
        //console.log(selectedDates)
                   }
            });



        setInterval(function () {
                    $.ajax({
                     type: 'GET',
                     url: '/shippers/getIdToRefreshShippersTracking/',
                     data: {
                         csrfmiddlewaretoken: "{{ csrf_token }}",
                     },
                     success: function (response) {
                var id_para_update = "{{ id_to_refresh }}"
                const agora = new Date();
                const horasAtuais = agora.getHours() +1;
                
                //const dataHoraFormatada = `${ano}-${mes}-${dia} ${horasAtuais.toString().padStart(2, '0')}:00:00`;

                const dataHora = id_para_update;
                const objDataHora = new Date(dataHora);
                const hora = objDataHora.getHours();
                //console.log(horasAtuais , id_para_update );

                console.log("DATAS PARA REFRESH DE HORA", agora.getHours() , "<>", hora );
                console.log("A resposta >  ",response.refreshDate, "<>", id_para_update)
                //exprimenta separar os ifs
                 if (response.refreshDate != id_para_update   ){
                    console.log("REFRESH",id_para_update, response.refreshDate)
                    $.ajax({
                        type: 'POST',
                        url: '/shippers/populate_shippers_trackingPage/',
                        data: {
                            csrfmiddlewaretoken: "{{ csrf_token }}",
                        },
                        success: function (req) {
                            //console.log("resposta!!!")
                            //console.log("tamanho req-->", req.length)
                            window.location.reload();
                    }
                    })
                 }else if(agora.getHours() != hora ){
                    console.log("hora difrente--> ")
                    $.ajax({
                        type: 'POST',
                        url: '/shippers/populate_shippers_trackingPage/',
                        data: {
                            csrfmiddlewaretoken: "{{ csrf_token }}",
                        },
                        success: function (req) {
                            //console.log("resposta!!!")
                            //console.log("tamanho req-->", req.length)
                            window.location.reload();
                    }
                    })
                 }
                     }
                 });

            }, 600000 ); //3600000

        $("#excel").click(function(){
            console.log("ENTROU")
            /* var myModal = new bootstrap.Modal(document.getElementById('modalHistorico'))
            myModal.show() */
        });

        $("#btnHistorico").click(function(){
            console.log("ENTROU")
            var myModal = new bootstrap.Modal(document.getElementById('modalHistorico'))
            myModal.show()
            //datePicker.setDate(null);
            //datePicker.clear();
            console.log("PAra limpar calendario")
        });

        $("#refresh-btn").click(function(){
            Swal.fire({
                    icon: 'success',
                    title: 'A fazer pesquisa, pode demorar algum tempo.',
                    showConfirmButton: false
                    });
            $.ajax({
                        type: 'POST',
                        url: '/shippers/populate_shippers_trackingPage/',
                        data: {
                            csrfmiddlewaretoken: "{{ csrf_token }}",
                            
                             
                        },//RE*ARAR ESTE REQUEST PARA FAZER O UPDATE CASO ECISTAM VALORES NOVOS
                        success: function (req) {
                            console.log("resposta!!!")
                            console.log("tamanho req-->", req.length)
                        if (req.length === 0){
                            Swal.fire({
                            icon: 'error',
                            title: 'A fazer pesquisa nao trouxe dados.',
                            showConfirmButton: false
                            });
                        }else{
                            setTimeout(function(){
                                Swal.fire({
                                icon: 'success',
                                title: 'A pesquisa trouxe dados.',
                                showConfirmButton: false
                            },4000, window.location.reload());
                        })
                            
                            
                       // window.location.reload()

                        }
                           
                            
                    }
                    })
        });
       
       
        $('#modalAlteracoes').on('show.bs.modal', function (e) {
            setTimeout(function() {
                $('#tabelaEdicoes').dataTable().fnFilter(' ');
                console.log('3 segundos');
                $('#tabelaEdicoes').dataTable().fnFilter('');
            }, 400);
           //datePicker.setDate(null);
            
        })

        $('#modalAlteracoes').on('hide.bs.modal', function (e) {
            console.log("FECHOU")
            
        })

        

        
        
        
  

        $("#excelDatado").click(function(){
            $('#modalCalendario').modal('show');
        });

        $("#saveModalExcel").click(function(){
            var startDate = datePicker.selectedDates[0];
            var endDate = datePicker.selectedDates[1];
            startDate = startDate.toISOString().slice(0, 10)
            endDate =  endDate.toISOString().slice(0, 10)
            console.log("datas",endDate,startDate)
            $.ajax({
                type: "POST",
                url: '/shippers/createExcelPortaria/',
                data: {csrfmiddlewaretoken: "{{ csrf_token }}",
                 start_date: startDate, end_date: endDate },
                success: function() {
                    console.log("Funciou")
                    var element = document.createElement('a');
                        element.setAttribute('href', '/media/shippers/portaria/workbookPortariaEntreData.xls');
                        element.setAttribute('download', 'workbookPortariaEntreDatas');
                        element.style.display = 'none';
                        document.body.appendChild(element);
                        element.click();
                        document.body.removeChild(element);
                },
                error: function(xhr) {
                    alert("Nao consegui carregar o ficheiro")
                }
            });
        });

       

            var table = $('#qadShipersTable').DataTable({
                paging: false,
                info: false,
                responsive: true,
                scrollY: 485,
                scrollX: true,
                scrollCollapse: true,
                dom: 'frtipB',
                orderCellsTop: true,
                /* select: {
                  style: 'single',
                  selector: 'tr'
                }, */
                order:[[1,'asc'],[2,'desc']],
                
                buttons: [
                    'excel'
                ],
            });


            var tabelaEdicoes = $('#tabelaEdicoes').DataTable({
                paging: false,
                info: false,
                scrollY: 345,
                scrollX: true,
                scrollCollapse: true,
                dom: 'frtipB',
                orderCellsTop: true,
                
                order:[[11,'desc']],
                columnDefs: [{
                    "targets": 0,
                    "type": "time-date-sort"
                },
                    
                ],
                buttons: [
                    'excel'
                ],
            });


             $('#qadShipersTable tbody').on('dblclick', 'tr', function () {
            var data = table.row(this).data();
            //alert('VocÃƒÆ’Ã‚Âª clicou na linha com ID: ' + data[11] + ' e nome: ' + data[1]);
            console.log("DATA ",data[11] )
            if(data[12] != "novo"){
            $('#modalAlteracoes').modal('show');
            tabelaEdicoes.clear()
            
            $.ajax({
                type: 'POST',
                url: '/shippers/json_trackingShippers/',
                data: {
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        abs_id: data[0],
                    },
                error: () => alert("Error ao criar a tabela"),
                success: (req) => {
                    /* Popular a table com dados de /json */
                    //console.log("DATA-->",data[11] )
                  
                    //console.log(`[#tabelaEdicoes] a carregar ${req.length} dados para a tabela`)
                    //var tabelaEdicoes = document.getElementById("tabelaEdicoes");
                    let row = ``
                    for(let value of req) {

                        console.log("REQ-->",  value["abs_id"])/* 
                        value["ship_time"],value["city"],value["country"],value["fob"],
                        value["mode_of_transport"],value["vehicle_id"],value["total_master_packs"],
                        value["confirmed"],value["id"],) */
                        /* console.log("Data--->", data) */
                        if(value["abs_id"].toString() === data[0]){
                            console.log("Esta linha e a original")
                        /* }else{
                            console.log("Esta linha ÃƒÆ’Ã‚Â© repetida") */
                        //ACABAR O REFRESH; COM O CODIGO COMENTADO EM BAIXO ESTAVA A APARECER O ID
                        row = `<tr>
                            <td title="${ value.abs_id }" > ${ value.abs_id }</td>
                            <td title="${ value.ship_date }"> ${ value.ship_date }</td>
                            <td title="${ value.ship_time }"> ${ value.ship_time }</td>
                            <td title="${ value.city }"> ${ value.city }</td>
                            <td title="${ value.country }"> ${ value.country }</td>
                            <td title="${ value.carrier }"> ${ value.carrier }</td>
                            <td title="${ value.fob }"> ${ value.fob }</td>
                            <td title="${ value.mode_of_transport }" > ${ value.mode_of_transport }</td>
                            <td title="${ value.vehicle_id }"> ${ value.vehicle_id }</td>
                            <td title="${ value.confirmed }"> ${ value.confirmed }</td>
                            <td> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${ value.comentarios }'
                                value='${ value.comentarios }'>
                            </td>
                            <td title="${ value.timestamp }"> ${ value.timestamp }</td>
                            <th style="display: none" >${ value.estado }</th>
                            <th style="display: none" >${ value.id }</th>
                        </tr>`;
                        tabelaEdicoes.rows.add($(row))

                        //---------------------------------------------------------//
                        /* tabelaEdicoes.rows.add(
                            [[
                                value["abs_id"],
                                value["ship_date"],
                                value["ship_time"],
                                value["city"],
                                value["country"],
                                value["carrier"],
                                value["fob"],
                                value["mode_of_transport"],
                                value["vehicle_id"],
                                value["total_master_packs"],
                                value["confirmed"],
                                value["timestamp"],
                                value["id"],
                            ]]
                        ) */
                    }
                    }
                    tabelaEdicoes.draw()
                    //console.log(`[#pnExpendableTable] ${req.length} dado carregados com sucesso (dados carregados em ${new Date() - t2}ms)`)
                    //$('#modalAlteracoes').modal('show');
                    
                }
            })
        }else{
            console.log("NOVO")
        }
        });


                // CODIGO PARA OS SUBITEMS 
            $('#qadShipersTable tbody').on('dblclick', 'tr', function () {
                
                var tr = $(this);
                var row = table.row(tr);
                $.ajax({
            type: 'POST',
            url: '/shippers/getSubItemsShippersTracking/',
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                'startDate':  startDate,
                'tracking_shipperspage_sub_items_id':row.querySelector('td:nth-child(9)'),
                    
            },
            success: function (req) {
                console.log(req)
            }
            })
                if (row.child.isShown()) {
                    // Se a sublinha já está sendo exibida, oculta ela
                    row.child.hide();
                    tr.removeClass('shown');
                } else {
                    // Caso contrário, adiciona a sublinha
                    //  row.child('Sublinha aqui').show();
                    for (let value of req){
                    row.child('<td style="font-size: 13px">Coluna 1:</td><td style="font-size: 13px">Coluna 2</td><td>Coluna 3</td><td>Coluna 4</td><td>Coluna 5</td>').show();
                        

                    }
                    tr.addClass('shown');


                }
            });

$("#btnMostrarSubitens").click(function(){
  if ($('#qadShipersTable tbody tr.shown').length > 0) {
    // Se houver algum subitem aberto, fecha todos eles
    $('#qadShipersTable tbody tr.shown').each(function () {
      var tr = $(this);
      var row = table.row(tr);
      row.child.hide();
      tr.removeClass('shown');
    });
  } else {
    // Caso contrário, adiciona a sublinha em todas as linhas
    $('#qadShipersTable tbody tr').each(function () {
      var tr = $(this);
      var row = table.row(tr);
      row.child('<td>Coluna 1</td><td>Coluna 2</td>').show();
      tr.addClass('shown');
    });
  }
}); 
 

            $("#btnSelectDataTabela").click(function(){
            //console.log(selectedDates1[0], selectedDates1[1]);
            table.clear()
            var startDate = selectedDates1[0];
            var endDate = selectedDates1[1];
            /* startDate = startDate.toISOString().slice(0, 10)
            endDate =  endDate.toISOString().slice(0, 10) */
            console.log("datas->",endDate,startDate)
            $.ajax({
            type: 'POST',
            url: '/shippers/historicoTabelaShippersTracking/',
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                'startDate':  startDate,
                'endDate':  endDate,
                    
            },
            success: function (req) {
                

                const t1 = new Date();
                
                let row = ``
                let tdStyle = '';
                contador =1
                console.log("TAMANHO----",req.length)
                if (req.length === 0){
                    Swal.fire({
                    icon: 'error',
                    title: 'A pesquisa falhou.',
                    showConfirmButton: false
                    });

                 }
                    else{
                for(let value of req) {
                    contador = contador + 1
                    if (value.estado ==="novo" && value.date_validation === "False"){
                        row = `<tr>
                                <td title="${value.abs_id}" > ${value.abs_id}</td>
                                <td title="${value.ship_date}"> ${value.ship_date}</td>
                                <td title="${value.ship_time}"> ${value.ship_time}</td>
                                <td title="${value.city}"> ${value.city}</td>
                                <td title="${value.country}"> ${value.country}</td>
                                <td title="${value.carrier}"> ${value.carrier}</td>
                                <td title="${value.fob}"> ${value.fob}</td>
                                <td title="${value.mode_of_transport}" > ${value.mode_of_transport}</td>
                                <td title="${value.vehicle_id}"> ${value.vehicle_id}</td>
                      
                                <td title="${value.confirmed}"> ${value.confirmed}</td>
                                <td> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${value.comentarios}'
                                value='${value.comentarios}'>
                            </td>
                                <td title="${value.timestamp}"> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                        </tr>`;
                        table.rows.add($(row))

                    }
                    else if (value.estado ==="novo" && value.date_validation === "True"){
                        row = `<tr>
                                <td title="${value.abs_id}" > ${value.abs_id}</td>
                                <td title="${value.ship_date}" style="background-color: #bdffd0;"> ${value.ship_date}</td>
                                <td title="${value.ship_time}"> ${value.ship_time}</td>
                                <td title="${value.city}"> ${value.city}</td>
                                <td title="${value.country}"> ${value.country}</td>
                                <td title="${value.carrier}"> ${value.carrier}</td>
                                <td title="${value.fob}"> ${value.fob}</td>
                                <td title="${value.mode_of_transport}" > ${value.mode_of_transport}</td>
                                <td title="${value.vehicle_id}"> ${value.vehicle_id}</td>
                      
                                <td title="${value.confirmed}"> ${value.confirmed}</td>
                                <td> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${value.comentarios}'
                                value='${value.comentarios}'>
                            </td>
                                <td title="${value.timestamp}"> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                <th style="display: none" >${value.id}</th>
                        </tr>`;
                        table.rows.add($(row))
                    }
                    
                    else if (value.estado ==="updated" && value.date_validation === "False"){

                   
                        tdStyle = 'style="background-color: #FBA51A;"';
                        row = `<tr>
                                <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                <td title="${value.ship_date}"${tdStyle}> ${value.ship_date}</td>
                                <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                <td title="${value.city}"${tdStyle}> ${value.city}</td>
                                <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                <td title="${value.fob}"${tdStyle}> ${value.fob}</td>
                                <td title="${value.mode_of_transport}"${tdStyle}> ${value.mode_of_transport}</td>
                                <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id}</td>
                                <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                <td ${tdStyle}> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${value.comentarios}'
                                value='${value.comentarios}'>
                            </td>
                                <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                <th style="display: none" >${value.id}</th>
                        </tr>`;
                        table.rows.add($(row))

                    }else if (value.estado ==="updated" && value.date_validation === "True"){

                   
                        tdStyle = 'style="background-color: #FBA51A;"';
                        row = `<tr>
                                <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                <td title="${value.ship_date}"style="background-color: #bdffd0;"> ${value.ship_date}</td>
                                <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                <td title="${value.city}"${tdStyle}> ${value.city}</td>
                                <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                <td title="${value.fob}"${tdStyle}> ${value.fob}</td>
                                <td title="${value.mode_of_transport}"${tdStyle}> ${value.mode_of_transport}</td>
                                <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id}</td>
                                <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                <td ${tdStyle}> <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${value.comentarios}'
                                value='${value.comentarios}'>
                            </td>
                                <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                <th style="display: none" >${value.id}</th>
                        </tr>`;
                        table.rows.add($(row))

                    }
                    else if (value.estado ==="deleted" && value.date_validation === "False"){
                        tdStyle = 'style="background-color: #fd5d3d;"';
                        row = `<tr>
                                <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                <td title="${value.ship_date}"${tdStyle}> ${value.ship_date}</td>
                                <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                <td title="${value.city}"${tdStyle}> ${value.city }</td>
                                <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                <td title="${value.fob}"${tdStyle}> ${value.fob }</td>
                                <td title="${value.mode_of_transport}" ${tdStyle}> ${value.mode_of_transport}</td>
                                <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id}</td>
                                <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                <td ${tdStyle} > <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${ value.comentarios }'
                                value='${ value.comentarios}'>
                            </td>
                                <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                <th style="display: none" >${value.id}</th>
                        </tr>`;
                        table.rows.add($(row))
                    }else if (value.estado ==="deleted" && value.date_validation === "True"){
                        tdStyle = 'style="background-color: #fd5d3d;"';
                        row = `<tr>
                                <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                <td title="${value.ship_date}"style="background-color: #bdffd0;> ${value.ship_date}</td>
                                <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                <td title="${value.city}"${tdStyle}> ${value.city }</td>
                                <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                <td title="${value.fob}"${tdStyle}> ${value.fob }</td>
                                <td title="${value.mode_of_transport}" ${tdStyle}> ${value.mode_of_transport}</td>
                                <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id}</td>
                                <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                <td ${tdStyle} > <input type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                data-placement="bottom" title='${ value.comentarios }'
                                value='${ value.comentarios}'>
                            </td>
                                <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                <th style="display: none" >${value.id}</th>
                        </tr>`;
                        table.rows.add($(row))
                    }
                    
                    }
                    
                    
                    /* if (value["estado"] === "outdated" && value["estado"] != "novo" && value["estado"] === "updated"){
                    console.log("nÃƒÆ’Ã‚Â£o ÃƒÆ’Ã‚Â© para adicionar linha")
                    }else{
                        console.log("Esta linha jÃƒÆ’Ã‚Â¡ foi alterada",tdStyle)
                        row += `<tr>
                                <td title="${ value.abs_id }" ${tdStyle}> ${ value.abs_id }</td>
                                <td title="${ value.ship_date }"${tdStyle}> ${ value.ship_date }</td>
                                <td title="${ value.ship_time }"${tdStyle}> ${ value.ship_time }</td>
                                <td title="${ value.city }"${tdStyle}> ${ value.city }</td>
                                <td title="${ value.country }"${tdStyle}> ${ value.country }</td>
                                <td title="${ value.carrier }"${tdStyle}> ${ value.carrier }</td>
                                <td title="${ value.fob }"${tdStyle}> ${ value.fob }</td>
                                <td title="${ value.mode_of_transport }" "${tdStyle}> ${ value.mode_of_transport }</td>
                                <td title="${ value.vehicle_id }"${tdStyle}> ${ value.vehicle_id }</td>
                                <td style="display: none" title="${ value.total_master_packs }"> ${ value.total_master_packs }</td>
                                <td title="${ value.confirmed }"${tdStyle}> ${ value.confirmed }</td>
                                <td title="${ value.timestamp }"${tdStyle}> ${ value.timestamp }</td>
                                <th style="display: none" >${ value.id }</th>
                        </tr>
                        `;
                        table.rows.add($(row))
                        
                        
                } */
                
                    const label = document.getElementById('minha-label');
                    const linhas = document.getElementById('qadShipersTable').rows.length;
                    label.textContent = `A tabela tem ${req.length} linhas.`;
                    console.log("contador",contador)
                    table.draw()
                    console.log("sucess");
                    console.log(`[#History] ${req.length} dado carregados com sucesso (dados carregados em ${new Date() - t1}ms)`)
                    var myModal = new bootstrap.Modal(document.getElementById('modalHistorico'))
                    myModal.hide();
                    $('#modalAlteracoes').modal('hide');
                        
                }
                
                    }
                

                    })
            
        });



    $("#btn-today").click(function(){
    const hoje = new Date();
    const ano = hoje.getFullYear();
    const mes = (hoje.getMonth() + 1).toString().padStart(2, "0");
    const dia = hoje.getDate().toString().padStart(2, "0");
    const dataFormatada = `${ano}-${mes}-${dia}`;
    console.log(dataFormatada);
    //$("#calendar").flatpickr().clear();
    //datePicker.setDate("03/28/2023");
    console.log(datePicker)
    table.clear()
    

/* datePicker.datePicker.setDate(dataFormatada) */
    $.ajax({
                type: 'POST',
                url: '/shippers/hojeTabelaShippersTracking/',
                data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                    'data':  dataFormatada,
                },
                success: function (req) {
                    const t1 = new Date();
                    let row = ``
                    let tdStyle = '';
                    contador =1
                    console.log("TAMANHO ",req.length)
                    if (req.length === 0){
                        Swal.fire({
                        icon: 'error',
                        title: 'A pesquisa falhou.',
                        showConfirmButton: false
                        });

                    }
                        else{
                            console.log("tem dados")
                            table.clear()
                    for(let value of req) {
                        contador = contador + 1
                        if (value.estado ==="novo" && value.date_validation === "False"){
                            row = `<tr>
                                    <td title="${value.abs_id}" > ${value.abs_id}</td>
                                    <td title="${value.ship_date}"> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"> ${value.ship_time}</td>
                                    <td title="${value.city}"> ${value.city}</td>
                                    <td title="${value.country}"> ${value.country}</td>
                                    <td title="${value.carrier}"> ${value.carrier}</td>
                                    <td title="${value.fob}"> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}" > ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"> ${value.vehicle_id}</td>
                                    <td title="${value.confirmed}"> ${value.confirmed}</td>
                                    <td> <input type="text" id="TESTE" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))

                        }else if (value.estado ==="novo" && value.date_validation === "True"){
                            row = `<tr>
                                    <td title="${value.abs_id}" > ${value.abs_id}</td>
                                    <td title="${value.ship_date}"style="background-color: #bdffd0;> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"> ${value.ship_time}</td>
                                    <td title="${value.city}"> ${value.city}</td>
                                    <td title="${value.country}"> ${value.country}</td>
                                    <td title="${value.carrier}"> ${value.carrier}</td>
                                    <td title="${value.fob}"> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}" > ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"> ${value.vehicle_id}</td>
                                    <td title="${value.confirmed}"> ${value.confirmed}</td>
                                    <td> <input type="text" id="TESTE" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))

                        }
                         else if (value.estado ==="novo" && value.date_validation === "True"){
                            row = `<tr>
                                    <td title="${value.abs_id}" > ${value.abs_id}</td>
                                    <td title="${value.ship_date}" style="background-color: #bdffd0;> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"> ${value.ship_time}</td>
                                    <td title="${value.city}"> ${value.city}</td>
                                    <td title="${value.country}"> ${value.country}</td>
                                    <td title="${value.carrier}"> ${value.carrier}</td>
                                    <td title="${value.fob}"> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}" > ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"> ${value.vehicle_id}</td>
                                    <td title="${value.confirmed}"> ${value.confirmed}</td>
                                    <td> <input type="text" id="TESTE" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))

                        }else if (value.estado ==="updated" && value.date_validation === "False"){

                    
                            tdStyle = 'style="background-color: #FBA51A;"';
                            row = `<tr>
                                    <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                    <td title="${value.ship_date}"${tdStyle}> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                    <td title="${value.city}"${tdStyle}> ${value.city}</td>
                                    <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                    <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                    <td title="${value.fob}"${tdStyle}> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}"${tdStyle}> ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id}</td>
                                    <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                    <td ${tdStyle}> <input id="TESTE" type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))

                        }else if (value.estado ==="updated" && value.date_validation === "True"){

                    
                            tdStyle = 'style="background-color: #FBA51A;"';
                            row = `<tr>
                                    <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                    <td title="${value.ship_date}"style="background-color: #bdffd0;> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                    <td title="${value.city}"${tdStyle}> ${value.city}</td>
                                    <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                    <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                    <td title="${value.fob}"${tdStyle}> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}"${tdStyle}> ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id}</td>
                                    <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                    <td ${tdStyle}> <input id="TESTE" type="text" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))

                        }
                        else if (value.estado ==="deleted" && value.date_validation === "False"){
                            tdStyle = 'style="background-color: #fd5d3d;"';
                            row = `<tr>
                                    <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                    <td title="${value.ship_date}"${tdStyle}> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                    <td title="${value.city}"${tdStyle}> ${ value.city}</td>
                                    <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                    <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                    <td title="${value.fob}"${tdStyle}> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}" ${tdStyle}> ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id }</td>
                                    <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                    <td ${tdStyle}>  <input type="text" id="TESTE" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))
                        }else if (value.estado ==="deleted" && value.date_validation === "True"){
                            tdStyle = 'style="background-color: #fd5d3d;"';
                            row = `<tr>
                                    <td title="${value.abs_id}" ${tdStyle}> ${value.abs_id}</td>
                                    <td title="${value.ship_date}" style="background-color: #bdffd0;"> ${value.ship_date}</td>
                                    <td title="${value.ship_time}"${tdStyle}> ${value.ship_time}</td>
                                    <td title="${value.city}"${tdStyle}> ${ value.city}</td>
                                    <td title="${value.country}"${tdStyle}> ${value.country}</td>
                                    <td title="${value.carrier}"${tdStyle}> ${value.carrier}</td>
                                    <td title="${value.fob}"${tdStyle}> ${value.fob}</td>
                                    <td title="${value.mode_of_transport}" ${tdStyle}> ${value.mode_of_transport}</td>
                                    <td title="${value.vehicle_id}"${tdStyle}> ${value.vehicle_id }</td>
                                    <td title="${value.confirmed}"${tdStyle}> ${value.confirmed}</td>
                                    <td ${tdStyle}>  <input type="text" id="TESTE" class="comentarioShippersTracking" style="width: 65px" data-toggle="tooltip"
                                        data-placement="bottom" title='${value.comentarios}'
                                        value='${value.comentarios}'>
                                    </td>
                                    <td title="${value.timestamp}"${tdStyle}> ${value.timestamp}</td>
                                    <th style="display: none" >${value.estado}</th>
                                    <th style="display: none" >${value.date_validation}</th>
                                    <th style="display: none" >${value.id}</th>
                            </tr>`;
                            table.rows.add($(row))
                        }
                        
                        
                        }

                        console.log("contador",contador)
                        table.draw()
                        var dismiss = document.getElementById("btnDismiss");
                        // Simula um clique no botÃƒÆ’Ã‚Â£o
                        //dismiss.click();
                        const label = document.getElementById('minha-label');
                        const linhas = document.getElementById('qadShipersTable').rows.length;
                        label.textContent = `A tabela tem ${req.length} linhas.`;
                        $("#modalHistorico").hide();
                        $(".modal-backdrop").remove();
                        var myModal = new bootstrap.Modal(document.getElementById('modalHistorico'))
                    myModal.hide();
                        //console.log("sucess");
                        console.log(`[#History] ${req.length} dado carregados com sucesso (dados carregados em ${new Date() - t1}ms)`)
                            }
                        }
                        })
                        
            })

            $("#TESTE").click(function(){
            alert("clicas-te na inputBox")
            }),
            


  
        setInterval(function () {
           
            $.ajax({
                        type: 'POST',
                        url: '/shippers/json_trackingShippersUpdate/',
                        data: {
                            csrfmiddlewaretoken: "{{ csrf_token }}",
                            
                             
                        },//RE*ARAR ESTE REQUEST PARA FAZER O UPDATE CASO VALORES NOVOS
                        success: function (req) {
                            console.log("resposta!!!", req.resposta)
                            if(req.resposta != "{{id_to_refresh}}"){
                                console.log("E para fazer refresh")
                                //location.reload();

                            }
                            
                    }
                    })



        },600000 );   //3600000

           $(document).on('click', '#excel', function () {
                $.ajax({
                    type: 'GET',
                    url: '/shippers/downloadExcelShippersTracking/',
                    data: {},
                    success: function () {
                        var element = document.createElement('a');
                        //Ainda por fazer
                        element.setAttribute('href', '/media/shippers/portaria/workbookShipersTracking.xls');
                        element.setAttribute('download', 'workbookShipersTracking.xls');

                        element.style.display = 'none';
                        document.body.appendChild(element);

                        element.click();

                        document.body.removeChild(element);
                    }
                })
            });
           
 
        });
        /* var alertShown = false; */
        //$('.comentarioShippersTracking').click(function(){
       /*  $('.comentarioShippersTracking').on('focusout', function() {
            
            alert("Input foi clicado!");
            console.log("clicaste no input");
            alertShown = true;
        
    }); */


// $(".comentarioShippersTracking").blur(function() {
//     var id = $(this).closest("tr").data("id");
//     var comentario = $(this).val();
//     var data = table.row(this).data();
// /*     var id = $(this).closest("tr").data("id");
//     var comentario = $(this).val(); */
//     console.log("DATA TABLE   ", data)
//     alert("ID da linha: " + id + "\nComentÃ¡rio: " + comentario);
// });

// const inputs = document.querySelectorAll('.comentarioShippersTracking');
//     inputs.forEach(input => {
//         input.addEventListener('blur', event => {
//             const row = event.target.closest('tr');
//             const id = row.querySelector('td:nth-child(1)').textContent;
//             const shipDate = row.querySelector('td:nth-child(2)').textContent;
//             const shipTime = row.querySelector('td:nth-child(3)').textContent;
//             const city = row.querySelector('td:nth-child(4)').textContent;
//             const country = row.querySelector('td:nth-child(5)').textContent;
//             const carrier = row.querySelector('td:nth-child(6)').textContent;
//             const fob = row.querySelector('td:nth-child(7)').textContent;
//             const modeOfTransport = row.querySelector('td:nth-child(8)').textContent;
//             const vehicleId = row.querySelector('td:nth-child(9)').textContent;
//             const comentarios = input.value;
//             const confirmed = row.querySelector('td:nth-child(11)').textContent;
//             const timestamp = row.querySelector('td:nth-child(12)').textContent;
            
//             // faÃ§a o que quiser com os valores obtidos
//             console.log(id, shipDate, shipTime, city, country, carrier, fob, modeOfTransport, vehicleId, comentarios, confirmed, timestamp);
//             $.ajax({
//                         type: 'POST',
//                         url: '/shippers/addCommentShippersTracking/',
//                         data: {
//                             csrfmiddlewaretoken: "{{ csrf_token }}",
//                             id : id,
//                             comentarios : comentarios,
//                             timestamp : timestamp,
//                         },
//                         error: () => Swal.fire({
//                                 icon: 'error',
//                                 title: 'Comentario nao foi adicionado',
//                                 showConfirmButton: false
//                                 }),
//                         success: function (req) {
//                             console.log("Comentario guardado !!!")
//                             Swal.fire({
//                                 icon: 'success',
//                                 title: 'Comentario adicionado',
//                                 showConfirmButton: false
//                                 });
//                             //console.log("tamanho req-->", req.length)
//                             //window.location.reload();
//                         }
//                     })
//         });
//    });
/* 
document.addEventListener('DOMContentLoaded', function() {
  const tabela = document.getElementById('qadShipersTable');
  if (tabela) {
    const linhas = tabela.rows.length;
    console.log(`A tabela tem ${linhas} linhas.`);
  } else {
    console.error('Nao foi possivel encontrar a tabela com o ID especificado.');
  }
}); */
const label = document.getElementById('minha-label');
const linhas = document.getElementById('qadShipersTable').rows.length;
label.textContent = `A tabela tem ${linhas} linhas.`;

//falta so adicionares uma label ou um btn com este valor "linhas"

$(document).on('blur', '.comentarioShippersTracking', function() {
    const $row = $(this).closest('tr');
    const id = $row.find('td:nth-child(1)').text();
    const shipDate = $row.find('td:nth-child(2)').text();
    const shipTime = $row.find('td:nth-child(3)').text();
    const city = $row.find('td:nth-child(4)').text();
    const country = $row.find('td:nth-child(5)').text();
    const carrier = $row.find('td:nth-child(6)').text();
    const fob = $row.find('td:nth-child(7)').text();
    const modeOfTransport = $row.find('td:nth-child(8)').text();
    const vehicleId = $row.find('td:nth-child(9)').text();
    const comentarios = $(this).val();
    const confirmed = $row.find('td:nth-child(11)').text();
    const timestamp = $row.find('td:nth-child(12)').text();

    console.log(id, timestamp, comentarios);

    $.ajax({
                        type: 'POST',
                        url: '/shippers/addCommentShippersTracking/',
                        data: {
                            csrfmiddlewaretoken: "{{ csrf_token }}",
                            id : id,
                            comentarios : comentarios,
                            timestamp : timestamp,
                        },
                        error: () => Swal.fire({
                                icon: 'error',
                                title: 'Comentario nao adicionado',
                                showConfirmButton: false
                                }),
                        success: function (req) {
                            console.log("Comentario guardado ",req)
                            Swal.fire({
                                icon: 'success',
                                title: 'Comentario adicionado',
                                showConfirmButton: false,
                                timer: 800
                                });
                            //console.log("tamanho req-->", req.length)
                            //window.location.reload();
                        }
                    })
        });

    

    </script>

{% endblock %}